(self.webpackChunkapril_crm=self.webpackChunkapril_crm||[]).push([[761],{8205:(e,t,n)=>{n.d(t,{R4:()=>s,Ss:()=>a,db:()=>r,pY:()=>l,wV:()=>c});var r=!0,a="gsr.bitrix24.ru",l=143,c=187,s=!1},4088:(e,t,n)=>{n.d(t,{A:()=>Ie});var r,a=n(7075),l=n(9733),c=n(6540),s=n(5826),o=n(9704),u=n(3342),i={setFetchedCallings:function setFetchedCallings(e){return{type:"callings/SET_FITCHED_CALLINGS",callings:e}},setFetchedDepartament:function setFetchedDepartament(e,t,n,r){return{type:"callings/SET_FITCHED_DEPARTAMENT",departament:e,currentUser:t,placement:n,domain:r}},setPrimrtiveStateProp:function setPrimrtiveStateProp(e,t){return{type:"callings/SET_STATE_PROP",name:e,value:t}},setFullCompleteStatus:function setFullCompleteStatus(e){return{type:"callings/SET_FULL_COMPLETE_STATUS",status:e}},setFinishStatus:function setFinishStatus(e,t){return{type:"callings/SET_FINISH_STATUS",status:e,result:t}}},p=n(4003);!function(e){e.SALES="sales",e.CUP="cup",e.TMC="tmc",e.SERVICE="service",e.EDU="edu",e.GENERAL="general"}(r||(r={}));var d,m,f,S,b,v,E=function setMenuStatus(e,t){return{type:"callings/result/SET_MENU_STATUS",status:e,menuType:t}},__awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function fulfilled(e){try{step(r.next(e))}catch(e){l(e)}}function rejected(e){try{step(r.throw(e))}catch(e){l(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))},__generator=function(e,t){var n,r,a,l,c={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,r=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(6===s[0]&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},_=function getResultMenu(e,t){return function(n,r){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(r){return n(E(e,t)),{default:{general:{next:{date:"",name:""},workStatus:{items:[],current:null},failReason:{items:[],current:null},noPerspektType:{items:[],current:null},isFail:!1},noResult:{type:{items:[],current:null}}}},[2]}))}))}},g=n(9002),y=n(8205),A=n(4705),h=n(467),T=n(4756),C=n.n(T),w=n(6266).A.create({baseURL:"https://april-hook.ru/api",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),P={getCollection:(f=(0,h.A)(C().mark((function _callee(e,t,n){var r,a,l,c=arguments;return C().wrap((function _callee$(s){for(;;)switch(s.prev=s.next){case 0:if(r=c.length>3&&void 0!==c[3]?c[3]:null,a=null,s.prev=2,r){s.next=9;break}return s.next=6,w[t](e);case 6:s.t0=s.sent,s.next=12;break;case 9:return s.next=11,w[t](e,r);case 11:s.t0=s.sent;case 12:if(!(l=s.t0)){s.next=16;break}return l.data&&0===l.data.resultCode&&l.data[n]&&(a=l.data.isCollection?l.data[n].data:l.data[n]),s.abrupt("return",a);case 16:s.next=21;break;case 18:return s.prev=18,s.t1=s.catch(2),s.abrupt("return",a);case 21:case"end":return s.stop()}}),_callee,null,[[2,18]])}))),function getCollection(e,t,n){return f.apply(this,arguments)}),setCollection:(m=(0,h.A)(C().mark((function _callee2(e,t){var n,r,a;return C().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return n=null,l.prev=1,r=(0,A.A)({},e,t),l.next=5,w.post(e,r);case 5:return(a=l.sent)&&0===a.data.resultCode&&(n=a.data.data),l.abrupt("return",n);case 10:return l.prev=10,l.t0=l.catch(1),l.abrupt("return",n);case 13:case"end":return l.stop()}}),_callee2,null,[[1,10]])}))),function setCollection(e,t){return m.apply(this,arguments)}),service:(d=(0,h.A)(C().mark((function _callee3(e,t,n,r){var a,l;return C().wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return a=null,c.prev=1,c.next=4,w[t](e,r);case 4:return(l=c.sent)&&l.data&&0===l.data.resultCode&&(a=l.data[n]),c.abrupt("return",a);case 9:return c.prev=9,c.t0=c.catch(1),c.abrupt("return",a);case 12:case"end":return c.stop()}}),_callee3,null,[[1,9]])}))),function service(e,t,n,r){return d.apply(this,arguments)})},I=(v=(0,h.A)(C().mark((function _callee4(e,t,n,r,a,l,c,s,o,u,i,p,d,m){var f,S,b;return C().wrap((function _callee4$(v){for(;;)switch(v.prev=v.next){case 0:return f=null,S={type:e,auth:{domain:t},company_id:n,deadline:r,responsible:a,created:l,name:c,comment:s,crm:o,company:u,smart:i,sale:p,isOneMore:d,placement:m},v.prev=2,v.next=5,w.post("task/warm",S);case 5:return(b=v.sent)&&b.data&&0===b.data.resultCode&&(f=b.data),v.abrupt("return",f);case 10:return v.prev=10,v.t0=v.catch(2),v.abrupt("return",f);case 13:case"end":return v.stop()}}),_callee4,null,[[2,10]])}))),b=(0,h.A)(C().mark((function _callee5(e,t,n,r,a){var l,c,s;return C().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return l=null,c={auth:{domain:e},company_id:t,placement:n,smart:a,responsible:r},o.prev=2,o.next=5,w.post("task/fail",c);case 5:return(s=o.sent)&&s.data&&0===s.data.resultCode&&(l=s.data.result),o.abrupt("return",l);case 10:return o.prev=10,o.t0=o.catch(2),o.abrupt("return",l);case 13:case"end":return o.stop()}}),_callee5,null,[[2,10]])}))),S=(0,h.A)(C().mark((function _callee6(e,t,n,r,a,l,c){var s,o,u;return C().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:return s=null,o={auth:{domain:e},company_id:t,placement:n,company:a,smart:l,responsibleId:r,isUnplannedPresentation:c},i.prev=2,i.next=5,w.post("presentation/done",o);case 5:return(u=i.sent)&&u.data&&0===u.data.resultCode&&(s=u.data.result),i.abrupt("return",s);case 10:return i.prev=10,i.t0=i.catch(2),i.abrupt("return",s);case 13:case"end":return i.stop()}}),_callee6,null,[[2,10]])}))),n(1715)),N=n(2056),O=function setPresentationCount(e,t){return{type:"callings/presentation/SET_PRESENTATION_COUNT",count:e,entityType:t}},R=n(2872),x={setPrimrtiveStateProp:function setPrimrtiveStateProp(e,t){return{type:"callings/plan/SET_STATE_PROP",name:e,value:t}},setFinishStatus:function setFinishStatus(e,t){return{type:"callings/plan/SET_FINISH_STATUS",status:e,result:t}}},k={setSaleComplete:function setSaleComplete(){return{type:"callings/postSale/SET_SALE_COMPLETE"}},setIsNewSaleStatus:function setIsNewSaleStatus(e){return{type:"callings/postSale/SET_IS_NEW_SALE_STATUS",status:e}},setSaleQuestionStatus:function setSaleQuestionStatus(e){return{type:"callings/postSale/SET_SALE_QUESTION_STATUS",status:e}},setSaleAnswerStatus:function setSaleAnswerStatus(e){return{type:"callings/postSale/SET_SALE_ANSWER_STATUS",status:e}},setFinishStatus:function setFinishStatus(e,t){return{type:"callings/postSale/SET_FINISH_STATUS",status:e,result:t}}},D=n(4850),F=n(8329),j=n(291),calling_thunk_awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function fulfilled(e){try{step(r.next(e))}catch(e){l(e)}}function rejected(e){try{step(r.throw(e))}catch(e){l(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))},calling_thunk_generator=function(e,t){var n,r,a,l,c={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,r=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(6===s[0]&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},L=function getCallingPlan(){return function(e,t){return calling_thunk_awaiter(void 0,void 0,void 0,(function(){var n,r,a,l,c,s;return calling_thunk_generator(this,(function(o){switch(o.label){case 0:return n=t(),r=n.app.domain,a=n.calling[N.u$.RESPONSIBILITY].current,l=n.calling.date,c={domain:r,userId:a&&a.ID,date:l},[4,g.o_.service("bitrix/callingtasks","post","tasks",c)];case 1:return(s=o.sent())&&e(i.setPrimrtiveStateProp(N.u$.PLAN,s)),[2]}}))}))}},M=function getBitrixItems(e){return function(t,n){return calling_thunk_awaiter(void 0,void 0,void 0,(function(){var r,a,l,c,s,o,u,d,m,f,S,b,v;return calling_thunk_generator(this,(function(E){switch(E.label){case 0:return Number(e.options.ID),null,e.placement.includes(N.u7.LEAD)?N.u7.LEAD:e.placement.includes(N.u7.COMPANY)&&N.u7.COMPANY,r=n(),a=null,l=r.app.domain,c=r.calling[N.u$.RESPONSIBILITY].current,e.placement.includes(N.u7.LEAD)?(s=Number(e.options.ID),(u=y.db)?[4,p.l.getLead(s)]:[3,2]):[3,5];case 1:u=E.sent(),E.label=2;case 2:return(o=u)?(b={domain:l,leadId:s,userId:null==c?void 0:c.ID},[4,P.service("smart/item/fromlead",I.b.POST,"data",b)]):[3,4];case 3:(a=E.sent())&&(a.ufCrm10_1709111529&&t(O(a.ufCrm10_1709111529,"smart")),a.ufCrm6_1709894507&&t(O(a.ufCrm6_1709894507,"smart")),t(i.setPrimrtiveStateProp(N.u$.SMART,a)),a.stageId&&("DT162_26:SUCCESS"!==a.stageId&&"DT156_12:SUCCESS"!==a.stageId||t(k.setSaleComplete()))),o&&(t(i.setPrimrtiveStateProp(N.u$.LEAD,o)),d=n().calling[N.u$.LEAD],t(i.setFullCompleteStatus(d))),E.label=4;case 4:return[3,9];case 5:return e.placement.includes(N.u7.COMPANY)?(m=Number(e.options.ID),(S=y.db)?[4,p.l.getCompany(m)]:[3,7]):[3,9];case 6:S=E.sent(),E.label=7;case 7:return(f=S)?(b={domain:l,companyId:m,userId:null==c?void 0:c.ID},[4,P.service("smart/item",I.b.POST,"data",b)]):[3,9];case 8:(a=E.sent())&&(a.ufCrm10_1709111529&&t(O(a.ufCrm10_1709111529,"smart")),a.ufCrm6_1709894507&&t(O(a.ufCrm6_1709894507,"smart")),t(i.setPrimrtiveStateProp(N.u$.SMART,a)),a.stageId&&("DT162_26:SUCCESS"!==a.stageId&&"DT156_12:SUCCESS"!==a.stageId||t(k.setSaleComplete()))),f&&(f.UF_CRM_1709807026&&t(O(f.UF_CRM_1709807026,"company")),t(i.setPrimrtiveStateProp(N.u$.COMPANY,f)),v=n().calling[N.u$.COMPANY],t(i.setFullCompleteStatus(v))),E.label=9;case 9:return[2]}}))}))}},U=function setCurentCallingProp(e,t){return function(n,r){return calling_thunk_awaiter(void 0,void 0,void 0,(function(){var a,l,c,s,o,u,p;return calling_thunk_generator(this,(function(d){switch(d.label){case 0:switch(a=r(),l=a.app.domain,e){case N.u$.RESPONSIBILITY:case N.u$.CREATED_BY:return[3,1];case R.zu.NAME:case R.zu.IS_ONE_MORE:return[3,3]}return[3,4];case 1:return c=a.calling[e].items,s=c.find((function(e){return e.ID==t})),n(i.setPrimrtiveStateProp(e,s)),o=a.plan[R.zu.DATE],u={domain:l,userId:s.ID,date:o},[4,g.o_.service("bitrix/callingtasks","post","tasks",u)];case 2:return(p=d.sent())&&n(i.setPrimrtiveStateProp(N.u$.PLAN,p)),[3,5];case 3:return n(x.setPrimrtiveStateProp(e,t)),[3,5];case 4:return[3,5];case 5:return[2]}}))}))}},Y=function send(){return function(e,t){return calling_thunk_awaiter(void 0,void 0,void 0,(function(){var n,r,a,l,c,s,o,u,i,p,d,m,f,S,b,v,_,g,y,A,h,T,C;return calling_thunk_generator(this,(function(w){switch(w.label){case 0:return n=t(),r=n.postSale,a=r.questionStatus,!r.isSaleComplete||a?[3,1]:(e(k.setSaleQuestionStatus(!0)),[3,3]);case 1:return e((0,F.Z)(!0)),e(k.setSaleQuestionStatus(!1)),l=n.app.domain,c=n.calling,s=n.report,o=n.plan,u=c[N.u$.RESPONSIBILITY].current,i=c[N.u$.CREATED_BY].current,p=o[R.zu.TYPE],d=o[R.zu.NAME],m=o[R.zu.DATE],f=(0,j.GP)(new Date(m),"dd.MM.yyyy HH:mm:ss"),S={responsibility:u,createdBy:i,type:p,name:d,deadline:f},b=s.report[D.as.COMMENT],v=s.report[D.as.WORK_STATUS],_=s.report[D.as.NORESULT_REASON],g=s.report[D.as.FAIL_TYPE],y=s.report[D.as.FAIL_REASON],A={description:b,workStatus:v,noresultReason:_,failType:g,failReason:y},h=c.placement,console.log("callingState.placement"),console.log(h),T={domain:l,plan:S,report:A,placement:h},console.log("sending data"),console.log(T),[4,P.service("full",I.b.POST,"result",T)];case 2:C=w.sent(),console.log(C),e((0,F.Z)(!1)),e(E(!1,null)),w.label=3;case 3:return[2]}}))}))}},$=n(5169),B=n(7917);const H=function ReportSelect(e){var t=e.label,n=e.nameForHandler,r=e.handleChange,a=e.current,l=e.items;return c.createElement(c.Fragment,null,c.createElement("label",{className:"col-md-12 col-form-label mt-2"},t),c.createElement("div",{className:"col-md-12 mt-1  mb-1"},c.createElement("select",{className:"form-control mt-0",value:a.code,onChange:function onChange(e){return r(n,e.target.value)}},l&&l.length&&l.map((function(e){return c.createElement("option",{key:"".concat(n,"-").concat(e.id),value:e.code},e.name)})))))};const z=function Noresult(e){var t=e.report,n=e.setReportProp,r=t.noresultReason.items,a=t.noresultReason.current;return c.createElement(c.Fragment,null,c.createElement("div",{className:"page-content"},c.createElement($.A,{fluid:!0},c.createElement(s.A,null,c.createElement("h3",{className:"text__bold col-md-12 col-form-label"},"Нерезультативный звонок")),c.createElement(s.A,{className:""},c.createElement(o.A,{className:"calling__noresult__status",sm:12},c.createElement(H,{label:"Причины нерезультативности/ Переноса",nameForHandler:D.as.NORESULT_REASON,handleChange:function handleChange(e,t){n(e,t)},current:a,items:r}))))))};const K=function Report(e){var t=e.report,n=e.setCurentCallingProp,r=e.setReportProp,l=(0,c.useState)(!1),u=(0,a.A)(l,2),i=(u[0],u[1],function handleChange(e,t){e===D.as.FAIL_REASON||e===D.as.COMMENT||e===D.as.FAIL_TYPE||e===D.as.NORESULT_REASON||e===D.as.WORK_STATUS?r(e,t):n(e,t)});t.workStatus.items;return c.createElement(c.Fragment,null,c.createElement("div",{className:"page-content"},c.createElement($.A,{fluid:!0},c.createElement(s.A,null,c.createElement("h3",{className:"text__bold col-md-4 col-form-label"},"Результат")),c.createElement(s.A,{className:""},c.createElement(o.A,{className:"calling__result__status",sm:6},c.createElement(H,{label:"Статус Работы",nameForHandler:D.as.WORK_STATUS,handleChange:i,current:t[D.as.WORK_STATUS].current,items:t[D.as.WORK_STATUS].items})),c.createElement(o.A,{className:"calling__result__status",sm:6},t[D.as.FAIL_TYPE].isActive&&c.createElement(H,{label:"Тип отказа",nameForHandler:D.as.FAIL_TYPE,handleChange:i,current:t[D.as.FAIL_TYPE].current,items:t[D.as.FAIL_TYPE].items}),t[D.as.FAIL_REASON].isActive&&c.createElement(H,{label:"Причины отказа",nameForHandler:D.as.FAIL_REASON,handleChange:i,current:t[D.as.FAIL_REASON].current,items:t[D.as.FAIL_REASON].items}))))))};var q=n(6540);const G=(0,l.Ng)((function mapSTate(e,t){return{report:e.report.report,isNoResult:t.isNoResult}}),{setCurentCallingProp:U,setReportProp:D.Tb.setReportProp})((function ReportContainer(e){var t=e.setCurentCallingProp,n=e.report,r=e.setReportProp;return e.isNoResult?q.createElement(z,{report:n,setReportProp:r}):q.createElement(K,{report:n,setCurentCallingProp:t,setReportProp:r})}));var W=n(6477);const Q=function Presentation(e){var t=e.presentation,n=(0,c.useState)(!1),r=(0,a.A)(n,2),l=r[0],u=r[1];return c.createElement(c.Fragment,null,c.createElement("div",{className:"page-content"},c.createElement($.A,{fluid:!0},c.createElement(s.A,{className:"mb-12"},c.createElement(o.A,{sm:12},c.createElement("h3",{className:"text__bold col-md-4 pb-0 col-form-label"},"Презентации"))),c.createElement(s.A,null,c.createElement(o.A,{sm:12},c.createElement(s.A,{sm:12,className:"d-flex flex-row justify-content-start align-items-start"},c.createElement(o.A,{sm:6,className:"d-flex flex-row justify-content-start align-items-start"},c.createElement("p",{className:"pt-0 col-md-12 col-form-label mt-0 d-flex flex-row\r justify-content-start align-items-center\r "},"По компании: ",c.createElement("span",null,t.companyCount,"   ")," "),c.createElement("p",{className:"pt-0 col-md-12 col-form-label ml-5 mt-0 d-flex flex-row\r justify-content-start align-items-center\r "},"Текущие: ",c.createElement("span",null,t.companyCount,"   ")))),c.createElement("div",{onClick:function onClick(){return u(!l)},className:"d-flex flex-column justify-content-start align-items-start"},c.createElement("label",{htmlFor:"example-string-input",className:"col-md-6 mt-1 col-form-label mt-3"},"Зафиксировать презентацию"),c.createElement("div",{className:"presentation__actions"},c.createElement(W.A,{style:{cursor:"pointer"},outline:!0,color:!1,className:"col-md-3 \n                                    ".concat(l?"presentation__badge__active":"presentation__badge")},"Была проведена"),l&&c.createElement("div",{className:"presentation__done__count"},"+1"))))))))};const V=(0,l.Ng)((function mapSTate(e){return{presentation:e.presentation.presentation,isUnplannedPresentation:e.presentation.isUnplannedPresentation}}),{})(Q);var X=n(6540);const Z=function Comment(e){var t=e.handleChange,n=(0,c.useState)(!1),r=(0,a.A)(n,2),l=r[0],s=r[1];return X.createElement(X.Fragment,null,X.createElement("label",{htmlFor:"description-string-input",className:"col-md-12 col-form-label"},"Опишите кратко что было"),X.createElement("div",{className:"col-md-12 mt-2  mb-2"},X.createElement("textarea",{onChange:function onChange(e){return t(N.u$.DESCRIPTION,e.target.value)},onFocus:function handleOnNameFocus(){l&&s(!1)},className:"form-control",type:"text",id:"description-string-input",lang:"rus",rows:"6"})))};var plan_thunk_awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function fulfilled(e){try{step(r.next(e))}catch(e){l(e)}}function rejected(e){try{step(r.throw(e))}catch(e){l(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))},plan_thunk_generator=function(e,t){var n,r,a,l,c={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,r=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(6===s[0]&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};const J=function Plan(e){var t=e.responsibility,n=e.createdBy,r=e.date,l=(e.name,e.type),s=e.setCurentPlanProp,o=e.setCurentCallingProp,u=e.changeDeadline,i=(e.createTask,(0,c.useState)(null==t?void 0:t.current)),p=(0,a.A)(i,2),d=(p[0],p[1]),m=(0,c.useState)(null==n?void 0:n.current),f=(0,a.A)(m,2),S=(f[0],f[1],(0,c.useState)(!1)),b=(0,a.A)(S,2),v=b[0],E=b[1];(0,c.useEffect)((function(){d(null==t?void 0:t.current)}),[null==t?void 0:t.current]);var _=function handleChange(e,t){e===N.u$.CREATED_BY||e===N.u$.RESPONSIBILITY?o(e,t):s(e,t)};return c.createElement(c.Fragment,null,c.createElement("label",{htmlFor:"example-string-input",className:"col-md-12 col-form-label ".concat(v?"calling-name-label-error":"")},v?"Заполните обязательное поле - Тема звонка":"Название - что нужно сделать"),c.createElement("div",{className:"col-md-12 mt-2 mb-2"},c.createElement("input",{onChange:function onChange(e){return _(R.zu.NAME,e.target.value)},onFocus:function handleOnNameFocus(){v&&E(!1)},className:"mt-0 form-control ".concat(v?"is-invalid":""),type:"text",id:"example-string-input",lang:"rus"})),c.createElement("label",{htmlFor:"example-datetime-local-input",className:"col-md-12 col-form-label"},"Дата и время звонка"),c.createElement("div",{className:"col-md-12 mt-2   mb-2"},c.createElement("input",{className:"form-control mt-0",type:"datetime-local",defaultValue:r,id:"example-datetime-local-input",lang:"rus",onChange:function onChange(e){return u(e.target.value)}})),c.createElement(H,{label:"Тип звонка",nameForHandler:R.zu.TYPE,handleChange:_,current:l.current,items:l.items}))};var ee=n(6540);const te=(0,l.Ng)((function mapSTate(e){return{responsibility:e.calling.responsibility.current,createdBy:e.calling.createdBy.current,type:e.plan[R.zu.TYPE],date:e.plan[R.zu.DATE],time:e.plan[R.zu.TIME],name:e.plan[R.zu.NAME],comment:e.report.comment}}),{setCurentCallingProp:U,setCurentPlanProp:x.setPrimrtiveStateProp,changeDeadline:function changeDeadline(e){return function(t,n){return plan_thunk_awaiter(void 0,void 0,void 0,(function(){return plan_thunk_generator(this,(function(r){return n(),t(x.setPrimrtiveStateProp(R.zu.DATE,e)),[2]}))}))}}})((function PlanContainer(e){var t=e.responsibility,n=e.createdBy,r=e.type,a=e.date,l=e.time,c=e.name,s=e.comment,o=e.setCurentPlanProp,u=e.setCurentCallingProp,i=e.changeDeadline;return ee.createElement(J,{responsibility:t,createdBy:n,type:r,date:a,time:l,name:c,comment:s,setCurentCallingProp:u,setCurentPlanProp:o,changeDeadline:i})}));const ne=function ResultMenu(e){var t=e.menuType,n=e.withPlan,r=(e.isFullComplete,e.setCurentCallingProp),a=e.send,l=e.setMenuStatus;return c.createElement(c.Fragment,null,c.createElement("div",{className:"page-content calling-result-wrapper"},c.createElement($.A,{fluid:!0},c.createElement(s.A,{className:"p-0"},c.createElement(o.A,{sm:6,className:"p-0"},c.createElement(G,{isNoResult:!1})),c.createElement(o.A,{sm:6,className:"p-0"},"result"===t?c.createElement(V,null):c.createElement(G,{isNoResult:!0}))),c.createElement(s.A,{className:"mt-2"},c.createElement(o.A,{sm:6}),c.createElement(o.A,{sm:6})),c.createElement(s.A,{className:"mt-2"},c.createElement(o.A,{sm:6},c.createElement("h3",{className:"bold"}," Комментарий")),c.createElement(o.A,{sm:6},c.createElement("h3",{className:"bold"}," Планирование следующего звонка"))),c.createElement(s.A,null,c.createElement(o.A,{sm:6},c.createElement(Z,{handleChange:function handleChange(e,t){r(e,t)}})),n&&c.createElement(o.A,{sm:6},c.createElement(te,null)))),c.createElement("div",{className:"calling__result__menu__footer"},c.createElement("div",{className:"calling__result__menu__buttons"},c.createElement(B.A,{className:"menu__button_send",size:"sm",onClick:a},"Отправить"),c.createElement(B.A,{className:"menu__button_cancel",size:"sm",onClick:function onClick(){l(!1,null)}},"Отмена")))))};var re=n(6540);const ae=(0,l.Ng)((function mapSTate(e){return{isFullComplete:e.calling.isFullComplete,isFinish:e.calling.isFinish,isMenuActive:e.result.isActive,menuType:e.result.type,report:e.report.report}}),{initialCalling:function initialCalling(e){return void 0===e&&(e=null),function(t,n){return calling_thunk_awaiter(void 0,void 0,void 0,(function(){var r,a,l,c,s,o,u;return calling_thunk_generator(this,(function(d){switch(d.label){case 0:return(r=e)||!y.db?[3,2]:[4,p.l.getPlacement()];case 1:r=d.sent(),d.label=2;case 2:return t(i.setFinishStatus(!1,"")),a=null,r&&r.placement&&(a=r,console.log("initialCalling calling placement"),console.log(a)),l=n(),c=l.app.domain,s=l.app.currentUser,o=null,u={domain:c},[4,g.o_.service("bitrix/departament","post","departament",u)];case 3:return(o=d.sent())&&(o=[]),t(i.setFetchedDepartament(o,s,a,c)),t(L()),r&&r.options?t(M(r)):t(i.setFullCompleteStatus(!0)),n(),[2]}}))}))}},setCurentCallingProp:U,setFinishStatus:i.setFinishStatus,setMenuStatus:_,send:Y})((function ResultMenuContainer(e){var t=e.report,n=e.menuType,r=e.setCurentCallingProp,l=e.initialCalling,s=e.isFullComplete,o=e.isFinish,u=e.isMenuActive,i=(e.setFinishStatus,e.setMenuStatus),p=e.send,d=function getwithPlan(){return t[D.as.WORK_STATUS].current&&("inJob"===t[D.as.WORK_STATUS].current.code||"setAside"===t[D.as.WORK_STATUS].current.code)},m=(0,c.useState)(d()),f=(0,a.A)(m,2),S=f[0],b=f[1];(0,c.useEffect)((function(){b(d())}),[t[D.as.WORK_STATUS].current]);var v=(0,c.useState)(!1),E=(0,a.A)(v,2),_=E[0],g=E[1],y=(0,c.useState)(o),A=(0,a.A)(y,2),h=A[0],T=A[1];return(0,c.useEffect)((function(){_||h||(l(),g(!0))}),[_,h]),(0,c.useEffect)((function(){o&&g(!1),T(o)}),[o]),u&&re.createElement(ne,{withPlan:S,menuType:n,isFullComplete:s,setCurentCallingProp:r,setMenuStatus:i,send:p})}));const le=function CallingList(e){var t=e.tasks,n=e.setResultMenuStatus;return c.createElement(c.Fragment,null,c.createElement(s.A,null,c.createElement(o.A,{xl:12},c.createElement("div",{className:"table-responsive p-4 calling__page__wrapper"},c.createElement("div",{className:"table-responsive"},c.createElement(u.A,{className:"align-middle mb-0"},c.createElement("thead",null,c.createElement("tr",null,c.createElement("th",null,"#"),c.createElement("th",null,"Что надо сделать"),c.createElement("th",null,"Тип"),c.createElement("th",null,"Крайний срок"),c.createElement("th",null,"Текущий статус"),c.createElement("th",null,"Действие"))),c.createElement("tbody",null,t&&t.length&&t.map((function(e,t){return c.createElement("tr",null,c.createElement("th",{scope:"row"},t+1),c.createElement("td",null,e.name),c.createElement("td",null,e.type),c.createElement("td",null,e.deadline),c.createElement("td",null,"no"===e.isExpired?c.createElement("span",{className:"statusSuccess"},"Запланирован"):"yes"===e.isExpired?c.createElement("span",{className:"statusWarning"},"Просрочен"):c.createElement("span",{className:"statusExpired"},"Скоро")),c.createElement("td",null,c.createElement("div",{className:"actionsCell"},c.createElement("button",{type:"button",className:"btn btn-sm  mr-5 badge__star",onClick:function onClick(){return n(!0,"result")}},"Результативный"),c.createElement("button",{type:"button",className:"btn btn-sm ms-2 badge__error",onClick:function onClick(){return n(!0,"noresult")}},"Не очень"),c.createElement("button",{type:"button",className:"btn btn-sm ms-2 badge__tolong",onClick:function onClick(){return n(!0,"expired")}},"Перенос"),c.createElement("button",{type:"button",className:"btn btn-sm ms-2 badge__cancel",onClick:function onClick(){return n(!0,"cancel")}},"Не считать"))))})))))))))};var ce=n(6540);const se=(0,l.Ng)((function mapSTate(e){return{tasks:e.tasks.tasks}}),{setResultMenuStatus:_})((function CallingListContainer(e){var t=e.tasks,n=e.setResultMenuStatus;return ce.createElement(le,{tasks:t,setResultMenuStatus:n})}));var oe=n(4929),ue=n(5580),ie=n(1301),tasks_thunk_awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function fulfilled(e){try{step(r.next(e))}catch(e){l(e)}}function rejected(e){try{step(r.throw(e))}catch(e){l(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))},tasks_thunk_generator=function(e,t){var n,r,a,l,c={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,r=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(6===s[0]&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},pe=function checkIfTaskIsOverdue(e){var t="no",n=new Date,r=new Date(e.deadline);r<n?t="yes":(r.setHours(0,0,0,0),n.setHours(0,0,0,0),n.getTime()===r.getTime()&&(t="almost"));return t},de=function parseTaskTitle(e){e.match(/^(.*?)(?=\sзапланирован)/),e.match(/запланирован[ао]?\s+(.*?)\s+\d{2}\.\d{2}\.\d{4}/);return{type:"Запланирован",name:e}},me=function getFormatDate(e){if(e){var t=(0,oe.H)(e);return(0,j.GP)(t,"d MMMM yyyy HH:mm",{locale:ue.ru})}return""},fe=n(8168),Se=n(3239),be=n(7592),ve=n(8210);const Ee=function SelectRadioButtons(e){e.isHorizontal;var t=e.name,n=e.values,r=e.currentId,a=e.errorMessage,l=e.selectCallback;e.cleanError;return c.createElement("div",{className:"radio__wrapper"},c.createElement(Se.A,null,c.createElement("div",{className:"radio__label"},a?c.createElement("p",{className:"error"},a):c.createElement(be.A,{for:"radio-buttons-group"},t)),c.createElement(Se.A,{check:!0,className:"d-flex flex-column  col-12"},n.map((function(e){return c.createElement(be.A,{check:!0},c.createElement(ve.A,{className:"col-12 h-10",type:"checkbox",id:"flexCheckDefault",checked:r==e.id,onChange:function onChange(t){!function onChangeHandler(e){l(e)}(e.id)}}),e.title||e.value)})))))};var _e=n(6556),ge=n(7535),ye=n(8756),Ae=n(6540),he=function PostSaleQuestionItems(e){var t=e.questions,n=e.error,r=e.isCreateNewSale,a=e.setAnswer,l=[];for(var c in t){var s=n&&n.type===c;t[c].isActive&&l.push(Ae.createElement("div",{className:"settings__item "},Ae.createElement(Ee,{key:"document-recipient-status}",isHorizontal:!0,name:t[c].title,values:[{id:0,value:"Начать новую продажу"},{id:1,value:"Это звонок после продажи"}],currentId:r?0:1,errorMessage:s&&n.error,selectCallback:function selectCallback(e){a(!e&&!0)}})))}return l};const Te=function PostSaleQuestion(e){var t=e.questions,n=e.isActive,r=e.isCreateNewSale,l=(e.isSaleComplete,e.questionStatus,e.setIsNewSaleStatus),s=e.setSaleAnswer,o=e.cancel,u=(0,c.useState)(!1),i=(0,a.A)(u,2),p=i[0],d=i[1],m=(0,c.useState)(!1),f=(0,a.A)(m,2),S=(f[0],f[1],(0,c.useState)()),b=(0,a.A)(S,2);b[0],b[1];(0,c.useEffect)((function(){d(n)}),[n]);var v=function toggle(){s()};return Ae.createElement("div",null,Ae.createElement(_e.A,(0,fe.A)({isOpen:p,toggle:v},t),Ae.createElement(ge.A,null,Ae.createElement(he,{questions:t,isCreateNewSale:r,setAnswer:l})),Ae.createElement(ye.A,{className:"p-2 calling-modal-q-footer"},Ae.createElement(B.A,{size:"sm",color:"primary",onClick:v},"Запланировать"),Ae.createElement(B.A,{size:"sm",color:"danger",onClick:function close(){o(!1)}},"Отмена"))))};var post_sale_thunk_awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function fulfilled(e){try{step(r.next(e))}catch(e){l(e)}}function rejected(e){try{step(r.throw(e))}catch(e){l(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))},post_sale_thunk_generator=function(e,t){var n,r,a,l,c={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,r=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){c.label=s[1];break}if(6===s[0]&&c.label<a[1]){c.label=a[1],a=s;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(s);break}a[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},Ce=n(6540);const we=(0,l.Ng)((function mapStateToProps(e,t){return{isActive:e.postSale.isActive,questions:e.postSale.questions,isSaleComplete:e.postSale.isSaleComplete,isCreateNewSale:e.postSale.isCreateNewSale,questionStatus:e.postSale.questionStatus}}),{setIsNewSaleStatus:k.setIsNewSaleStatus,cancel:k.setSaleQuestionStatus,setSaleAnswer:function setSaleAnswer(){return function(e,t){return post_sale_thunk_awaiter(void 0,void 0,void 0,(function(){return post_sale_thunk_generator(this,(function(t){return e(k.setSaleAnswerStatus(!0)),e(Y()),[2]}))}))}}})((function PostSaleQuestionContainer(e){var t=e.questions,n=e.isActive,r=e.isCreateNewSale,a=e.setIsNewSaleStatus,l=e.isSaleComplete,c=e.questionStatus,s=e.setSaleAnswer,o=e.cancel;return Ce.createElement(Te,{questions:t,isActive:n,isCreateNewSale:r,setIsNewSaleStatus:a,isSaleComplete:l,questionStatus:c,setSaleAnswer:s,cancel:o})}));var Pe=n(6540);const Ie=(0,l.Ng)((function mapSTate(e){return{isMenuActive:e.result.isActive,isFinish:e.calling.isFinish,result:e.calling.result}}),{initialCallingReport:function initialCallingReport(){return function(e,t){return tasks_thunk_awaiter(void 0,void 0,void 0,(function(){var n,r,a,l,c,s,o,u,i;return tasks_thunk_generator(this,(function(d){switch(d.label){case 0:return n=t(),console.log("initialCallingReport"),console.log(n),r=n.app.domain,a=n.app.currentUser,(c=y.db)?[4,p.l.getPlacement()]:[3,2];case 1:c=d.sent(),d.label=2;case 2:return l=c,s={domain:r||y.Ss,userId:a||y.wV,placement:l||{placement:"COMPANY",options:{ID:y.pY}}},console.log("placement",l),[4,g.o_.service("bitrix/callingreport",I.b.POST,"tasks",s)];case 3:return o=d.sent(),u={domain:r||y.Ss,userId:a||y.wV},[4,g.o_.service("front/portal",I.b.POST,"portal",u)];case 4:return d.sent(),o&&o.length&&(i=o.map((function(e){var t=de(e.title),n=t.type;return{name:t.name,type:n,isExpired:pe(e),deadline:me(e.deadline)}})),e(ie.l1.setFetchedTasks(i))),t(),[2]}}))}))}},setFinishStatus:i.setFinishStatus})((function CallingContainer(e){var t=e.isMenuActive,n=e.isFinish,r=e.result,l=e.setFinishStatus,s=e.initialCallingReport,o=(0,c.useState)(!1),u=(0,a.A)(o,2),i=u[0],p=u[1],d=(0,c.useState)(n),m=(0,a.A)(d,2),f=m[0],S=m[1];return(0,c.useEffect)((function(){i||f||(s(),p(!0))}),[i,f]),(0,c.useEffect)((function(){n&&p(!1),S(n)}),[n]),f?Pe.createElement(CallingFinish,{result:r,setFinishStatus:l}):i&&Pe.createElement(Pe.Fragment,null,t?Pe.createElement(ae,null):Pe.createElement(se,null),Pe.createElement(we,null))}))},6750:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(6540),a=n(6229);const l=function Logo(){return r.createElement("img",{className:"logo",src:a,alt:"logo"})};n(4003),n(9245);var c=n(6540);const s=function Gradient(e){e.isResized;var t=e.isActive,n=(e.currentRoute,(0,r.useRef)(null));return(0,r.useEffect)((function(){}),[]),c.createElement("div",{ref:n,className:"monohrom__containerApril"},c.createElement("div",{className:"content__wrapper"},c.createElement("div",{className:"newchildren__wrapper"},c.createElement(l,null)),t&&c.createElement("p",{className:"loader__title"},"Загрузка  . . .")))};const o=(0,n(9733).Ng)((function mapStateToProps(e,t){return{isResized:e.app.isResized,isActive:t.isActive}}),{})(s);var u=n(6540);const i=function Preloader(e){var t=e.currentRoute;return u.createElement(o,{currentRoute:t,isActive:!0},u.createElement(l,null))}},6745:(e,t,n)=>{n.d(t,{Ay:()=>w,Fc:()=>T,Vh:()=>h});var r=n(4705),a=n(467),l=n(4756),c=n.n(l),s=n(4003),o=n(9002),u=n(8205),i=n(8329),p=n(9245),d=n(1715);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m="SET_APP_DEAL",f="SET_RESIZE_STATUS",S="SET_APP_DATA",b="SET_APP_BITRIX_DATA",v="SET_INITIALIZED_SUCCESS",E={domain:"",company:null,user:"",currentUser:null,token:"",dealId:null,bitrix:{company:null,deal:null,lead:null},isResized:!1,initialized:!1},_=function setAppData(e,t,n,r,a,l){return{type:S,domain:e,companyId:t,userId:n,currentUser:r,token:a,dealId:l}},g=function setAppBitrixData(e,t){return{type:b,company:e,deal:t}},y=function setResizeStatus(e){return{type:f,boolean:e}},A=function setInitializedSuccess(){return{type:v}},h=function initial(){return function(){var e=(0,a.A)(c().mark((function _callee(e,t){var n,r,a,l,o;return c().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(e((0,i.Z)(!0)),n=t(),r=n.router.current,null,null,u.db&&r.route===p.a$.CALLING&&e(C()),!u.db){c.next=12;break}return c.next=9,s.l.getDomain();case 9:c.t0=c.sent,c.next=13;break;case 12:c.t0=null;case 13:if(a=c.t0,l=a||u.Ss,!r||!r.route){c.next=30;break}if(r.route!==p.a$.CALLING){c.next=27;break}if(c.t1=u.db,!c.t1){c.next=22;break}return c.next=21,s.l.getCurrentUser();case 21:c.t1=c.sent;case 22:o=c.t1,e(_(l,null,null,o,"",null)),e(A()),c.next=30;break;case 27:e(_(l,null,null,null,"",null)),e(A()),e((0,i.Z)(!1));case 30:e((0,p._t)(p.xY.CALLING,!1)),e((0,i.Z)(!1));case 32:case"end":return c.stop()}}),_callee)})));return function(t,n){return e.apply(this,arguments)}}()},T=function getBitrixData(e,t,n,r,l,i,m){return function(){var f=(0,a.A)(c().mark((function _callee2(a,f){var S,b,v,E,y,A,h,T;return c().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(null,null,S={currentCompany:null,currentDeal:null},b=null,v=null,E=!1,!u.db){c.next=12;break}return c.next=9,s.l.getDealAndCompany(i,l);case 9:S=c.sent,c.next=22;break;case 12:if(!l){c.next=17;break}return y={domain:t,companyId:l},c.next=16,o.o_.service("bitrixcompany",d.b.POST,"company",y);case 16:S.currentCompany=c.sent;case 17:if(!i){c.next=22;break}return A={domain:t,dealId:i},c.next=21,o.o_.service("bitrixdeal",d.b.POST,"deal",A);case 21:S.currentCompany=c.sent;case 22:h=S.company,T=S.deal,h&&h.ID&&(b=h.ID),T&&T.ID&&(v=T.ID),a(_(t,b,r,n,m,v)),a(g(h,T)),a((0,p._t)(e,E));case 29:case"end":return c.stop()}}),_callee2)})));return function(e,t){return f.apply(this,arguments)}}()},C=function getResizeCalling(){return function(){var e=(0,a.A)(c().mark((function _callee5(e,t){return c().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.l.getResizeCalling();case 2:e(y(!0));case 3:case"end":return t.stop()}}),_callee5)})));return function(t,n){return e.apply(this,arguments)}}()};const w=function app(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return _objectSpread(_objectSpread({},e),{},{domain:t.domain,company:t.companyId,user:t.userId,token:t.token,dealId:t.dealId,currentUser:t.currentUser});case b:return _objectSpread(_objectSpread({},e),{},{bitrix:_objectSpread(_objectSpread({},e.bitrix),{},{company:t.company,deal:t.deal}),initialized:!0});case m:return _objectSpread(_objectSpread({},e),{},{dealId:t.dealId,bitrix:_objectSpread(_objectSpread({},e.bitrix),{},{deal:t.deal})});case f:return _objectSpread(_objectSpread({},e),{},{isResized:t.status});case v:return _objectSpread(_objectSpread({},e),{},{initialized:!0});default:return e}}},8329:(e,t,n)=>{n.d(t,{A:()=>s,Z:()=>c});var r=n(4705);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a={inProgress:!0},l="PRELOADER",c=function setPreloader(e){return{type:l,bool:e}};const s=function preloader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;return t.type===l&&e.inProgress!==t.bool?_objectSpread(_objectSpread({},e),{},{inProgress:t.bool}):e}},9002:(e,t,n)=>{n.d(t,{o_:()=>A});var r=n(467),a=n(4705),l=n(4756),c=n.n(l),s=n(8205),o=n(1715),u=n(6266);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var i=u.A.create({baseURL:s.R4?"http://localhost:8000/api":"https://april-online.ru/api",withCredentials:!0,headers:(0,a.A)((0,a.A)((0,a.A)({"content-type":"application/json",accept:"application/json"},"accept","application/json"),"X-Requested-With","XMLHttpRequest"),"X-API-KEY","e0336d3b27299e405a344d2475627c5810eab829a4e5c1214e452e20519d5984")});u.A.create({baseURL:s.R4?"http://localhost:8000":"https://april-online.ru",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}});b=(0,r.A)(c().mark((function _callee3(){var e,t,n;return c().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return e=null,r.prev=1,r.next=4,i.get("profile");case 4:return t=r.sent,(n=t.data)&&(0===n.resultCode?e=n.deal:n.message),r.abrupt("return",e);case 10:return r.prev=10,r.t0=r.catch(1),r.abrupt("return",e);case 13:case"end":return r.stop()}}),_callee3,null,[[1,10]])}))),S=(0,r.A)(c().mark((function _callee4(e){var t,n;return c().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,r.prev=1,r.next=4,i.post("deal",_objectSpread({},e));case 4:return(n=r.sent)&&(0===n.resultCode?t=n.deal:n.message),r.abrupt("return",t);case 9:return r.prev=9,r.t0=r.catch(1),r.abrupt("return",t);case 12:case"end":return r.stop()}}),_callee4,null,[[1,9]])}))),f=(0,r.A)(c().mark((function _callee5(e,t){var n,r,a;return c().wrap((function _callee5$(l){for(;;)switch(l.prev=l.next){case 0:return n=null,l.prev=1,l.next=4,i.post("getDeal",{dealId:e,domain:t});case 4:return r=l.sent,(a=r.data)&&0===a.resultCode&&(n=a.deal),l.abrupt("return",n);case 10:return l.prev=10,l.t0=l.catch(1),l.abrupt("return",n);case 13:case"end":return l.stop()}}),_callee5,null,[[1,10]])}))),m=(0,r.A)(c().mark((function _callee6(e,t,n,r,a){var l,s,o,u;return c().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return l=null,c.prev=1,c.next=4,i.post("getDescription",{domain:e,userId:t,complect:n,infoblocks:r,groups:a});case 4:if(!(s=c.sent)||!s.data||0!==s.data.resultCode){c.next=9;break}return o=s.data.file,u=s.data.fileBase64,c.abrupt("return",{link:o,file:u});case 9:c.next=14;break;case 11:return c.prev=11,c.t0=c.catch(1),c.abrupt("return",l);case 14:case"end":return c.stop()}}),_callee6,null,[[1,11]])}))),d=(0,r.A)(c().mark((function _callee7(e,t,n,r,a){var l,s;return c().wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return l=null,c.prev=1,c.next=4,i.post("get/offer",{domain:e,userId:t,complect:n,infoblocks:r,groups:a});case 4:(s=c.sent)&&s.data&&s.data.resultCode,c.next=11;break;case 8:return c.prev=8,c.t0=c.catch(1),c.abrupt("return",l);case 11:case"end":return c.stop()}}),_callee7,null,[[1,8]])}))),p=(0,r.A)(c().mark((function _callee8(e,t,n){var r,a;return c().wrap((function _callee8$(n){for(;;)switch(n.prev=n.next){case 0:return r=null,n.prev=1,n.next=4,i.post("get/offer",{domain:e,userId:t,complect,infoblocks,groups});case 4:(a=n.sent)&&a.data&&a.data.resultCode,n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(1),n.abrupt("return",r);case 11:case"end":return n.stop()}}),_callee8,null,[[1,8]])})));var p,d,m,f,S,b,v,E,_,g,y,A={getCollection:(_=(0,r.A)(c().mark((function _callee9(e,t,n,r){var a,l;return c().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if(a=null,c.prev=1,r){c.next=8;break}return c.next=5,i[t](e);case 5:c.t0=c.sent,c.next=11;break;case 8:return c.next=10,i[t](e,r);case 10:c.t0=c.sent;case 11:if(!(l=c.t0)){c.next=15;break}return l.data&&0===l.data.resultCode&&l.data[n]&&(a=l.data.isCollection?l.data[n].data:l.data[n]),c.abrupt("return",a);case 15:c.next=20;break;case 17:return c.prev=17,c.t1=c.catch(1),c.abrupt("return",a);case 20:case"end":return c.stop()}}),_callee9,null,[[1,17]])}))),function getCollection(e,t,n,r){return _.apply(this,arguments)}),setCollection:(E=(0,r.A)(c().mark((function _callee10(e,t){var n,r,l;return c().wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return n=null,c.prev=1,r=(0,a.A)({},e,t),c.next=5,i.post(e,r);case 5:return(l=c.sent)&&0===l.data.resultCode&&(n=l.data.data),c.abrupt("return",n);case 10:return c.prev=10,c.t0=c.catch(1),c.abrupt("return",n);case 13:case"end":return c.stop()}}),_callee10,null,[[1,10]])}))),function setCollection(e,t){return E.apply(this,arguments)}),service:(v=(0,r.A)(c().mark((function _callee11(e,t,n,r){var a,l;return c().wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return a=null,c.prev=1,c.next=4,i[t](e,r);case 4:return(l=c.sent)&&l.data&&(0===l.data.resultCode?a=l.data.data?l.data.data[n]:l.data[n]:1===l.data.resultCode&&(l.data.message?console.log("".concat(n," ").concat(l.data.message)):console.log(l))),c.abrupt("return",a);case 9:return c.prev=9,c.t0=c.catch(1),c.abrupt("return",a);case 12:case"end":return c.stop()}}),_callee11,null,[[1,9]])}))),function service(e,t,n,r){return v.apply(this,arguments)})},h=(g=(0,r.A)(c().mark((function _callee12(e,t,n,r,l,s,u,p,d,m,f,S,b,v,E,_,g,y){var A,h,T,C,w,P,I,N,O,R,x,k;return c().wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return T=null,C={FIELDS:(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)({},v.dealName.bitrixId,"".concat(t)),v.assigned.bitrixId,n),v.category.bitrixId,v.category.value),v.stage.bitrixId,v.stage.value),v.opened.bitrixId,v.opened.value),"PROBABILITY",30),"OPPORTUNITY",0),"CURRENCY_ID","RUB"),"UF_CRM_5B39D7C2EC0AB",!0),PARAMS:{REGISTER_SONET_EVENT:"Y"}},w=isNaN(+_.contractSupplyPropSuppliesQuantity)?1:+_.contractSupplyPropSuppliesQuantity,P=g?g.contractConsaltingProp:_.contractConsaltingProp,I=g?g.contractConsaltingComment:_.contractConsaltingComment,N={id:r,fields:(A={},(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(A,b.contract.bitrixId,l),b.companyId.bitrixId,s),b.npa.bitrixId,u.npa),b.la.bitrixId,u.la),b.c.bitrixId,u.c),b.sp.bitrixId,u.sp),b.er.bitrixId,p.er),b.per.bitrixId,p.per),b.erinpac.bitrixId,p.erinpac),b.lt.bitrixId,m.lt),(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(A,b.plt.bitrixId,m.plt),b.ltinpac.bitrixId,m.ltinpac),b.freeBlocks.bitrixId,d),b.consalting.bitrixId,f),b.field_14.bitrixId,S),v.category.bitrixId,v.category.value),v.stage.bitrixId,"C".concat(v.category.value,":NEW"))),PARAMS:{REGISTER_SONET_EVENT:"Y"}},O={id:r,fields:(h={},(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(h,E.complectName.bitrixId,_.name),E.abonementTime.bitrixId,1===_.contractCoefficient?null:_.contractCoefficient),E.consalting.bitrixId,P),E.note2.bitrixId,I),E.hdd.bitrixId,_.contractSupplyProp1?_.contractSupplyProp1:""),E.way.bitrixId,_.contractSupplyProp2?_.contractSupplyProp2:""),E.note.bitrixId,_.contractSupplyPropComment?_.contractSupplyPropComment:""),E.note3.bitrixId,_.contractSupplyPropEmail?_.contractSupplyPropEmail:""),E.supply.bitrixId,_.supplyName?_.supplyName:""),E.supplyForContract.bitrixId,_.contractSupplyName?_.contractSupplyName:""),(0,a.A)((0,a.A)((0,a.A)((0,a.A)(h,E.loginsQuantity.bitrixId,_.contractSupplyPropLoginsQuantity?_.contractSupplyPropLoginsQuantity:""),E.contractSupplyPropSuppliesQuantity.bitrixId,w),E.supplyForContract.bitrixId,_.contractSupplyName),E.field_1.bitrixId,_.quantityForKp))},R=y.map((function(e,t){var n=e.prepayment,a=e.price.current,l=e.price.default,c=l-a;return{id:e.id||e.number,priceNetto:l,price:a,discountSum:c,discountTypeId:1,ownerId:r,ownerType:"D",productName:"".concat(e.name," ").concat(e.supply.name),quantity:e.price.quantity||n,customized:"Y",supply:e.supplyName,measureCode:e.price.measure.code,measureId:e.price.measure.id,sort:t}})),x={domain:e,dealId:r,setDealData:C,updateDealInfoblocksData:N,updateDealContractData:O,setProductRowsData:{ownerType:"D",ownerId:r,productRows:R},updateProductRowsData:{id:null,fields:{priceNetto:null,price:null,discountSum:null,discountTypeId:1}}},c.prev=11,c.next=14,i[o.b.POST]("konstructor/bitrix/deal/update",x);case 14:return(k=c.sent)&&k.data&&(0===k.data.resultCode?k.data.data&&(T=k.data.data.dealId):1===k.data.resultCode&&(k.data.message?console.log("".concat(k.data.message)):console.log(k))),c.abrupt("return",T);case 19:return c.prev=19,c.t0=c.catch(11),c.abrupt("return",T);case 22:case"end":return c.stop()}}),_callee12,null,[[11,19]])}))),u.A.create({baseURL:"http://localhost:8000/api",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}}));y=(0,r.A)(c().mark((function _callee13(e,t,n,r){var a,l;return c().wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return a=null,c.prev=1,c.next=4,h[t](e,r);case 4:return(l=c.sent)&&l.data&&(0===l.data.resultCode?a=l.data.data?l.data.data[n]:l.data[n]:1===l.data.resultCode&&(l.data.message?console.log("".concat(n," ").concat(l.data.message)):console.log(l))),c.abrupt("return",a);case 9:return c.prev=9,c.t0=c.catch(1),c.abrupt("return",a);case 12:case"end":return c.stop()}}),_callee13,null,[[1,9]])})))},4003:(e,t,n)=>{n.d(t,{l:()=>h});var r=n(467),a=n(4705),l=n(4756),c=n.n(l),s=n(3953);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var o,u,i,p,d,m,f,S,b,v,E,_,g,y,A,h={getMethod:(A=(0,r.A)(c().mark((function _callee(e,t){var n,r;return c().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return n=null,a.prev=1,a.next=4,s.g9(e,t);case 4:return(r=a.sent)&&r.answer&&r.answer.result&&(n=r.answer.result),a.abrupt("return",n);case 9:return a.prev=9,a.t0=a.catch(1),console.log("error"),console.log(dealResponse),console.log(a.t0),a.abrupt("return",n);case 15:case"end":return a.stop()}}),_callee,null,[[1,9]])}))),function getMethod(e,t){return A.apply(this,arguments)}),getPlacement:(y=(0,r.A)(c().mark((function _callee2(){var e;return c().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.ot.info();case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),_callee2)}))),function getPlacement(){return y.apply(this,arguments)}),getCompanyId:(g=(0,r.A)(c().mark((function _callee3(){var e,t;return c().wrap((function _callee3$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,h.getPlacement();case 3:return e=n.sent,t=e.options.ID,n.abrupt("return",Number(t));case 8:return n.prev=8,n.t0=n.catch(0),n.abrupt("return",null);case 11:case"end":return n.stop()}}),_callee3,null,[[0,8]])}))),function getCompanyId(){return g.apply(this,arguments)}),getCurrentUserId:(_=(0,r.A)(c().mark((function _callee4(e){var t,n;return c().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,r.next=3,(0,s.g9)("crm.company.get",{id:e});case 3:return n=(n=r.sent).answer&&n.answer.result,t=n?n.ASSIGNED_BY_ID:null,r.abrupt("return",t);case 7:case"end":return r.stop()}}),_callee4)}))),function getCurrentUserId(e){return _.apply(this,arguments)}),getCurrentUser:(E=(0,r.A)(c().mark((function _callee5(){var e,t;return c().wrap((function _callee5$(n){for(;;)switch(n.prev=n.next){case 0:return e=null,n.prev=1,n.next=4,(0,s.g9)("user.current");case 4:return(t=n.sent)&&t.answer&&t.answer.result&&t.answer.result.ID&&(e=t.answer.result),n.abrupt("return",e);case 9:return n.prev=9,n.t0=n.catch(1),console.log(n.t0),n.abrupt("return",null);case 13:case"end":return n.stop()}}),_callee5,null,[[1,9]])}))),function getCurrentUser(){return E.apply(this,arguments)}),getResize:(v=(0,r.A)(c().mark((function _callee6(){var e,t;return c().wrap((function _callee6$(n){for(;;)switch(n.prev=n.next){case 0:return e=.9*window.screen.height,t=.73*window.screen.width,n.next=5,(0,s.Ru)(t,e);case 5:n.sent;case 6:case"end":return n.stop()}}),_callee6)}))),function getResize(){return v.apply(this,arguments)}),getResizeCalling:(b=(0,r.A)(c().mark((function _callee7(){return c().wrap((function _callee7$(e){for(;;)switch(e.prev=e.next){case 0:return window.screen.height,window.screen.width,e.next=5,(0,s.eQ)();case 5:e.sent;case 6:case"end":return e.stop()}}),_callee7)}))),function getResizeCalling(){return b.apply(this,arguments)}),getScroll:(S=(0,r.A)(c().mark((function _callee8(){var e,t;return c().wrap((function _callee8$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,console.log("scroll"),n.next=4,(0,s.TC)();case 4:return e=n.sent,console.log(e),n.next=8,(0,s.OO)(100);case 8:t=n.sent,console.log(t),n.next=14;break;case 12:n.prev=12,n.t0=n.catch(0);case 14:case"end":return n.stop()}}),_callee8,null,[[0,12]])}))),function getScroll(){return S.apply(this,arguments)}),getLead:(f=(0,r.A)(c().mark((function _callee9(e){var t,n;return c().wrap((function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,console.log("crm.lead.get"),r.prev=2,r.next=5,s.g9("crm.lead.get",{id:e});case 5:return(n=r.sent)&&n.answer&&n.answer.result&&(t=n.answer.result,console.log(t)),r.abrupt("return",t);case 10:return r.prev=10,r.t0=r.catch(2),console.log("error"),console.log(dealResponse),console.log(r.t0),r.abrupt("return",t);case 16:case"end":return r.stop()}}),_callee9,null,[[2,10]])}))),function getLead(e){return f.apply(this,arguments)}),getCompany:(m=(0,r.A)(c().mark((function _callee10(e){var t,n;return c().wrap((function _callee10$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,console.log("crm.company.get"),r.prev=2,r.next=5,s.g9("crm.company.get",{id:e,select:["TITLE","ID","UF_CRM_1706007840","UF_CRM_1706007882","UF_CRM_1706007856"]});case 5:return(n=r.sent)&&n.answer&&n.answer.result&&(t=n.answer.result,console.log(t)),r.abrupt("return",t);case 10:return r.prev=10,r.t0=r.catch(2),console.log("error"),console.log(dealResponse),console.log(r.t0),r.abrupt("return",t);case 16:case"end":return r.stop()}}),_callee10,null,[[2,10]])}))),function getCompany(e){return m.apply(this,arguments)}),getDeal:(d=(0,r.A)(c().mark((function _callee11(e){var t,n;return c().wrap((function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,r.prev=1,r.next=4,s.g9("crm.deal.get",{id:e,select:["TITLE","COMPANY_ID","ID","UF_CRM_1695372881","UF_CRM_1695373462","UF_CRM_1695373326"]});case 4:return(n=r.sent)&&n.answer&&n.answer.result&&(t=n.answer.result),r.abrupt("return",t);case 9:return r.prev=9,r.t0=r.catch(1),console.log("error"),console.log(dealResponse),console.log(r.t0),r.abrupt("return",t);case 15:case"end":return r.stop()}}),_callee11,null,[[1,9]])}))),function getDeal(e){return d.apply(this,arguments)}),getDealAndCompany:(p=(0,r.A)(c().mark((function _callee12(){var e,t,n,r,a=arguments;return c().wrap((function _callee12$(l){for(;;)switch(l.prev=l.next){case 0:if(e=a.length>0&&void 0!==a[0]?a[0]:null,t=a.length>1&&void 0!==a[1]?a[1]:null,l.prev=2,n=null,r=null,t||!e){l.next=16;break}return l.next=8,h.getDeal(e);case 8:if(!(n=l.sent)||!n.COMPANY_ID){l.next=14;break}return t=n.COMPANY_ID,l.next=13,h.getCompany(t);case 13:r=l.sent;case 14:l.next=21;break;case 16:if(!t||e){l.next=21;break}return l.next=19,h.getCompany(t);case 19:r=l.sent,n&&n.COMPANY_ID&&(t=n.COMPANY_ID);case 21:return l.abrupt("return",{company:r,deal:n});case 24:return l.prev=24,l.t0=l.catch(2),console.error("Произошла ошибка при выполнении запроса",l.t0),l.abrupt("return",{company:null,deal:null});case 28:case"end":return l.stop()}}),_callee12,null,[[2,24]])}))),function getDealAndCompany(){return p.apply(this,arguments)}),getSmart:(i=(0,r.A)(c().mark((function _callee13(e){var t,n;return c().wrap((function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:return t=null,$method="/crm.item.list.json",$data={entityTypeId:e,filter:{"=assignedById":$userId,COMPANY_ID:$companyId}},r.prev=3,r.next=6,s.g9("crm.item.list",{id:dealId});case 6:return(n=r.sent)&&n.answer&&n.answer.result&&(t=n.answer.result.items),r.abrupt("return",t);case 11:return r.prev=11,r.t0=r.catch(3),console.log("error"),console.log(dealResponse),console.log(r.t0),r.abrupt("return",t);case 17:case"end":return r.stop()}}),_callee13,null,[[3,11]])}))),function getSmart(e){return i.apply(this,arguments)}),getDomain:(u=(0,r.A)(c().mark((function _callee14(){var e;return c().wrap((function _callee14$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.xI();case 2:return t.sent,t.next=5,s.FB();case 5:return e=t.sent,t.abrupt("return",e);case 7:case"end":return t.stop()}}),_callee14)}))),function getDomain(){return u.apply(this,arguments)}),updateRecipient:(o=(0,r.A)(c().mark((function _callee15(e,t,n,r,a){var l,o,u,i,p,d,m,f,S;return c().wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:if(!e&&!t){c.next=28;break}if(!(n||r||a)){c.next=28;break}return l={},o={},n&&(l.UF_CRM_1706007840=n,o.UF_CRM_1695372881=n),r&&(l.UF_CRM_1706007856=r,o.UF_CRM_1695373326=r),a&&(l.UF_CRM_1706007882=a,o.UF_CRM_1695373462=a),u={ID:e,FIELDS:_objectSpread({},o),PARAMS:{REGISTER_SONET_EVENT:"Y"}},i={ID:t,FIELDS:_objectSpread({},l),PARAMS:{REGISTER_SONET_EVENT:"Y"}},p="crm.company.update",d=null,m=null,c.prev=13,c.next=16,s.g9("crm.deal.update",_objectSpread({},u));case 16:return f=c.sent,c.next=19,s.g9(p,_objectSpread({},i));case 19:return S=c.sent,d=f.answer&&f.answer.result,m=S.answer&&S.answer.result,c.abrupt("return",{deal:d,company:m});case 25:return c.prev=25,c.t0=c.catch(13),c.abrupt("return",d);case 28:case"end":return c.stop()}}),_callee15,null,[[13,25]])}))),function updateRecipient(e,t,n,r,a){return o.apply(this,arguments)})}},2056:(e,t,n)=>{n.d(t,{Ay:()=>s,u$:()=>a,u7:()=>l});var r,a,l,__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};!function(e){e.RESPONSIBILITY="responsibility",e.CREATED_BY="createdBy",e.STATUS="status",e.CRM="crm",e.PLAN="plan",e.COMPANY="company",e.LEAD="lead",e.SMART="smart"}(a||(a={})),function(e){e.LEAD="LEAD",e.COMPANY="COMPANY"}(l||(l={}));var c=((r={})[a.RESPONSIBILITY]={items:[],current:null},r[a.CREATED_BY]={items:[],current:null},r.placement=null,r.groupId=28,r.company=null,r.smart=null,r.isFullComplete=!1,r.isFinish=!1,r.result="",r);const s=function calling(e,t){var n,r,l;switch(void 0===e&&(e=c),t.type){case"callings/SET_FITCHED_CALLINGS":return __assign(__assign({},e),{calling:t.callings});case"callings/SET_FITCHED_DEPARTAMENT":var s=t.currentUser,o=107;return"alfacentr.bitrix24.ru"===t.domain&&(o=158),console.log("SET_FITCHED_DEPARTAMENT"),console.log({responsibility:__assign(__assign({},e.responsibility),{items:t.departament,current:s}),createdBy:__assign(__assign({},e.createdBy),{items:t.departament,current:{ID:o}}),placement:t.placement}),__assign(__assign({},e),{responsibility:__assign(__assign({},e.responsibility),{items:t.departament,current:s}),createdBy:__assign(__assign({},e.createdBy),{items:t.departament,current:{ID:o}}),placement:t.placement});case"callings/SET_STATE_PROP":switch(t.name){case a.RESPONSIBILITY:case a.CREATED_BY:return __assign(__assign({},e),((n={})[t.name]=__assign(__assign({},e[t.name]),{current:t.value}),n));default:return __assign(__assign({},e),((r={})[t.name]=t.value,r))}case"callings/SET_FULL_COMPLETE_STATUS":return __assign(__assign({},e),{isFullComplete:t.status});case"callings/SET_FINISH_STATUS":return(l={})[a.RESPONSIBILITY]={items:[],current:null},l[a.CREATED_BY]={items:[],current:null},l.placement=null,l.groupId=28,l.company=null,l.smart=null,l.isFullComplete=!1,l.isFinish=t.status,l.result=t.result,l;default:return e}}},2872:(e,t,n)=>{n.d(t,{Ay:()=>i,zu:()=>l});var r,a,l,c=n(291),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};!function(e){e.COLD="cold",e.WARM="warm",e.PRESENTATION="presentation",e.HOT="hot",e.PAY="moneyAwait"}(a||(a={})),function(e){e.NAME="name",e.RESPONSIBILITY="responsibility",e.CREATED_BY="createdBy",e.DATE="date",e.TIME="time",e.TYPE="type",e.STATUS="status",e.IS_ONE_MORE="isOneMore",e.IS_ACTIVE="isActive"}(l||(l={}));var s=function getInitialDate(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);return{first:(0,c.GP)(t,"yyyy-MM-dd"),current:(0,c.GP)(e,"yyyy-MM-dd HH:mm:ss")}},o=[{id:1,code:a.WARM,name:"Звонок"},{id:2,code:a.PRESENTATION,name:"Презентация"},{id:3,code:a.HOT,name:"Решение"},{id:4,code:a.PAY,name:"Оплата"}],u=((r={})[l.TYPE]={items:o,current:o[0],isChanged:!1},r[l.NAME]="",r[l.DATE]=s().current,r[l.TIME]=null,r[l.IS_ACTIVE]=!1,r);const i=function plan(e,t){var n,r,a;switch(void 0===e&&(e=u),t.type){case"callings/plan/SET_STATE_PROP":if(t.name===l.TYPE){var c=e[t.name].items.find((function(e){return e.code==t.value}));return __assign(__assign({},e),((n={})[t.name]=__assign(__assign({},e[t.name]),{current:c}),n))}return __assign(__assign({},e),((r={})[t.name]=t.value,r));case"callings/plan/SET_FINISH_STATUS":return(a={})[l.TYPE]={items:o,current:o[0]},a.name="",a.date=s().current,a.time=null,a;default:return e}}},4850:(e,t,n)=>{n.d(t,{Ay:()=>o,Tb:()=>c,as:()=>a});var r,a,__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};!function(e){e.WORK_STATUS="workStatus",e.NORESULT_REASON="noresultReason",e.FAIL_TYPE="failType",e.FAIL_REASON="failReason",e.COMMENT="comment"}(a||(a={}));var l={isNewEvent:!1,report:(r={},r[a.WORK_STATUS]={items:[{id:0,code:"inJob",name:"В работе"},{id:1,code:"setAside",name:"Отложено"},{id:2,code:"success",name:"Продажа"},{id:3,code:"fail",name:"Отказ"}],current:{id:0,code:"inJob",name:"В работе"},default:{id:0,code:"inJob",name:"В работе"},isActive:!0,isChanged:!1},r[a.NORESULT_REASON]={items:[{id:0,code:"secretar",name:"Секретарь"},{id:1,code:"nopickup",name:"Недозвон - трубку не берут"},{id:2,code:"nonumber",name:"Недозвон - номер не существует"},{id:3,code:"busy",name:"Занято"},{id:4,code:"notime",name:"Перенос - не было времени"},{id:5,code:"nocontact",name:"Контактера нет на месте"},{id:6,code:"giveup",name:"Просят оставить свой номер"},{id:7,code:"bay",name:"Не интересует, до свидания"},{id:8,code:"wrong",name:"По телефону отвечает не та организация"},{id:9,code:"auto",name:"Автоответчик"}],current:{id:1,code:"nopickup",name:"Недозвон - трубку не берут"},default:{id:1,code:"nopickup",name:"Недозвон - трубку не берут"},isActive:!1,isChanged:!1},r[a.FAIL_TYPE]={items:[{id:0,code:"garant",name:"Гарант/Запрет"},{id:1,code:"go",name:"Покупает ГО"},{id:2,code:"territory",name:"Чужая территория"},{id:3,code:"accountant",name:"Бухприх"},{id:4,code:"autsorc",name:"Аутсорсинг"},{id:5,code:"depend",name:"Несамостоятельная организация"},{id:6,code:"failure",name:"Отказ"}],current:{id:0,code:"garant",name:"Гарант/Запрет"},default:{id:0,code:"garant",name:"Гарант/Запрет"},isActive:!1,isChanged:!1},r[a.FAIL_REASON]={items:[{id:0,code:"fail_notime",name:"Не было времени"},{id:1,code:"c_habit",name:"Конкуренты - привыкли"},{id:2,code:"c_prepay",name:"Конкуренты - оплачено"},{id:3,code:"c_price",name:"Конкуренты - цена"},{id:4,code:"money",name:"Дорого/нет Денег"},{id:5,code:"to_cheap",name:"Слишком дешево"},{id:6,code:"nomoney",name:"Нет денег"},{id:7,code:"noneed",name:"Не видят надобности"},{id:8,code:"lpr",name:"ЛПР против"},{id:9,code:"employee",name:"Ключевой сотрудник против"}],current:{id:0,code:"fail_notime",name:"Не было времени"},default:{id:0,code:"fail_notime",name:"Не было времени"},isActive:!1,isChanged:!1},r[a.COMMENT]="",r)},c={setFetchedDepartament:function setFetchedDepartament(e,t,n,r){return{type:"report/SET_FITCHED_DEPARTAMENT",departament:e,currentUser:t,placement:n,domain:r}},setReportProp:function setReportProp(e,t){return{type:"report/SET_REPORT_PROP",propName:e,value:t}}},s=function getreportState(e,t,n){var r=__assign({},e.report);if(t===a.COMMENT)r[a.COMMENT]=n;else{var l=r[t].items.find((function(e){return e.code==n}));l&&(t===a.WORK_STATUS?"fail"==n?r[a.FAIL_TYPE].isActive=!0:(r[a.FAIL_TYPE].isActive=!1,r[a.FAIL_REASON].isActive=!1):t===a.FAIL_TYPE&&(r[a.FAIL_REASON].isActive="failure"==n),r[t]=__assign(__assign({},r[t]),{current:l}))}return r};const o=function report(e,t){switch(void 0===e&&(e=l),t.type){case"report/SET_FITCHED_DEPARTAMENT":default:return e;case"report/SET_REPORT_PROP":return __assign(__assign({},e),{report:s(e,t.propName,t.value)})}}},1301:(e,t,n)=>{n.d(t,{Ay:()=>l,l1:()=>a});var __assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)},r={tasks:null,isFetched:!1},a={setFetchedTasks:function setFetchedTasks(e){return{type:"report/SET_FITCHED_TASKS",tasks:e}}};const l=function tasks(e,t){return void 0===e&&(e=r),"report/SET_FITCHED_TASKS"===t.type?__assign(__assign({},e),{tasks:t.tasks}):e}},9245:(e,t,n)=>{n.d(t,{QB:()=>i,_t:()=>o,a$:()=>r,xY:()=>a});var r,a,l=n(8329),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};!function(e){e.GLOBAL="global",e.KONSTRUCTOR="konstructor",e.PRODUCTS="products",e.TEMPLATE="template",e.DOCUMENT="document",e.REPORT="report",e.CALLING="calling",e.TRANSKRIBATION="transcribation",e.FINISH="finish"}(r||(r={})),function(e){e.KONSTRUCTOR="konstructor",e.REPORT="report",e.CALLING="calling",e.TRANSKRIBATION="transcribation"}(a||(a={}));var c={routes:[{id:0,name:"Начальные настройки",route:r.GLOBAL},{id:1,name:"Конструктор",route:r.KONSTRUCTOR},{id:2,name:"Цены и сравнение комплектов",route:r.PRODUCTS},{id:3,name:"Выбор Шаблона",route:r.TEMPLATE},{id:4,name:"Документ",route:r.DOCUMENT},{id:5,name:"Отчет",route:r.REPORT},{id:6,name:"Звонки",route:r.CALLING},{id:7,name:"Транскрибация",route:r.TRANSKRIBATION},{id:8,name:"Финиш",route:r.FINISH}],current:{id:6,name:"Звонки",route:r.CALLING},previous:null,next:null},s=function setCurrentRoute(e){return{type:"router/SET_CURRENT",id:e}},o=function setInitialRoute(e,t){return function(e,t){e(u(r.CALLING))}},u=function navigate(e){return function(t,n){console.log("navigate "+e);var r=n().router.routes.find((function(t){return t.route===e}));if(r){var a=r.id;t(s(a))}t((0,l.Z)(!1))}},i=function router(e,t){if(void 0===e&&(e=c),"router/SET_CURRENT"===t.type){var n=e.routes.find((function(e){return e.id==t.id})),r=e.current,a=e.previous;return n?__assign(__assign({},e),{current:n,previous:r,next:a}):e}return e}},6277:(e,t,n)=>{n.d(t,{A:()=>P});var r=n(2960),a=n(1265),l=n(6745),c=n(8329),s=n(9245),o=n(2056),u=n(4705);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,u.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var i="SET_TOP_DISPLAY_STATUS",p="SET_SCROLL_TOP_STATUS",d={isTopDisplayShowing:!0,scrollTop:!1};const m=function display(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return _objectSpread(_objectSpread({},e),{},{isTopDisplayShowing:t.status});case p:return _objectSpread(_objectSpread({},e),{},{scrollTop:t.status});default:return e}};var f,S=n(4850),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};!function(e){e.RESULT="result",e.NORESULT="noresult",e.EXPIRED="expired"}(f||(f={}));var b={isActive:!1,type:null};const v=function callingResult(e,t){switch(void 0===e&&(e=b),t.type){case"callings/result/SET_FITCHED_LIST":default:return e;case"callings/result/SET_MENU_STATUS":return __assign(__assign({},e),{isActive:t.status,type:t.status?t.menuType:null})}};var E,_,g=n(1301),presentation_reducer_assign=function(){return presentation_reducer_assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},presentation_reducer_assign.apply(this,arguments)};!function(e){e.PRESENTATION="presentation",e.IS_UNPLANNED_PRESENTATION="isUnplannedPresentation"}(_||(_={}));var y=((E={presentation:{companyCount:0,smartCout:0}})[_.IS_UNPLANNED_PRESENTATION]=!1,E);const A=function presentation(e,t){var n;switch(void 0===e&&(e=y),t.type){case"callings/presentation/SET_STATE_PROP":return presentation_reducer_assign(presentation_reducer_assign({},e),((n={})[t.name]=t.value,n));case"callings/presentation/SET_PRESENTATION_COUNT":var r=presentation_reducer_assign({},e.presentation);return"company"==t.entityType?r.companyCount=t.count:"smart"==t.entityType&&(r.smartCout=t.count),presentation_reducer_assign(presentation_reducer_assign({},e),{presentation:presentation_reducer_assign(presentation_reducer_assign({},e.presentation),r)});default:return e}};var h=n(2872),post_sale_reducer_assign=function(){return post_sale_reducer_assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},post_sale_reducer_assign.apply(this,arguments)},T={isActive:!1,questionStatus:!1,isSaleComplete:!1,isCreateNewSale:!1,questions:{new:{id:0,title:"Уже сделана продажа этому клиенту",isActive:!0,value:!0,isAnswered:!1}}};const C=function postSale(e,t){switch(void 0===e&&(e=T),t.type){case"callings/postSale/SET_SALE_COMPLETE":return post_sale_reducer_assign(post_sale_reducer_assign({},e),{isSaleComplete:!0});case"callings/postSale/SET_IS_NEW_SALE_STATUS":return post_sale_reducer_assign(post_sale_reducer_assign({},e),{isCreateNewSale:t.status});case"callings/postSale/SET_SALE_ANSWER_STATUS":return post_sale_reducer_assign(post_sale_reducer_assign({},e),{questionStatus:t.status});case"callings/postSale/SET_SALE_QUESTION_STATUS":return post_sale_reducer_assign(post_sale_reducer_assign({},e),{isActive:t.status});case"callings/postSale/SET_FINISH_STATUS":return{isActive:!1,questionStatus:!1,isSaleComplete:!1,isCreateNewSale:!1,questions:{new:{id:0,title:"Уже сделана продажа этому клиенту",isActive:!0,value:!0,isAnswered:!1}}};default:return e}};var w=(0,r.HY)({app:l.Ay,display:m,router:s.QB,result:v,preloader:c.A,calling:o.Ay,tasks:g.Ay,presentation:A,plan:h.Ay,report:S.Ay,postSale:C});const P=(0,r.y$)(w,(0,r.Tw)(a.A))},1715:(e,t,n)=>{var r,a;n.d(t,{b:()=>r}),function(e){e.GET="get",e.POST="post",e.PUT="put",e.DELETE="delete"}(r||(r={})),function(e){e.ENTITY="entity",e.ENTITIES="entities"}(a||(a={}))}},e=>{e.O(0,[227,610,794,996,992,248,644,484,214],(()=>{return t=3670,e(e.s=t);var t}));e.O()}]);