(self.webpackChunkapril_crm=self.webpackChunkapril_crm||[]).push([[801],{5382:(e,t,n)=>{var a=n(6540),r=n(5338),l=n(2960),c=n(1265),s=n(3733),o=n(8329),i=n(9245),u=n(277),p=n(4705);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,p.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m="SET_TOP_DISPLAY_STATUS",d="SET_SCROLL_TOP_STATUS",f={isTopDisplayShowing:!0,scrollTop:!1};const g=function display(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return _objectSpread(_objectSpread({},e),{},{isTopDisplayShowing:t.status});case d:return _objectSpread(_objectSpread({},e),{},{scrollTop:t.status});default:return e}};var b=n(5750),E=(0,l.HY)({app:s.Ay,display:g,router:i.QB,preloader:o.A,calling:u.Ay,report:b.Ay});const v=(0,l.y$)(E,(0,l.Tw)(c.A));var y=n(9733),S=n(4924),A=document.getElementById("root");(0,r.H)(A).render(a.createElement(y.Kq,{store:v},a.createElement(S.A,null))),window.store=v},8205:(e,t,n)=>{n.d(t,{R4:()=>s,Ss:()=>r,db:()=>a,pY:()=>l,wV:()=>c});var a=!0,r="gsr.bitrix24.ru",l=145,c=187,s=!1},8575:(e,t,n)=>{var a=n(7075),r=n(9733),l=n(6540),c=n(277),s=n(5169),o=n(5826),i=n(9704),u=n(7917),p=n(3239),m=n(7592),d=n(8210),f=n(4758),g=n(5606),b=n(291),E=n(5580),v=n(8168);const y=function SelectRadioButtons(e){e.isHorizontal;var t=e.name,n=e.values,a=e.currentId,r=e.errorMessage,c=e.selectCallback;e.cleanError;return l.createElement("div",{className:"radio__wrapper"},l.createElement(p.A,null,l.createElement("div",{className:"radio__label"},r?l.createElement("p",{className:"error"},r):l.createElement(m.A,{for:"radio-buttons-group"},t)),l.createElement(p.A,{check:!0,className:"d-flex flex-column  col-12"},n.map((function(e){return l.createElement(m.A,{check:!0},l.createElement(d.A,{className:"col-12 h-10",type:"checkbox",id:"flexCheckDefault",checked:a==e.id,onChange:function onChange(t){!function onChangeHandler(e){c(e)}(e.id)}}),e.title||e.value)})))))};var S=n(6556),A=n(7535),h=n(8756),_=n(6540),C=function PostSaleQuestionItems(e){var t=e.questions,n=e.error,a=e.isCreateNewSale,r=e.setAnswer,l=[];for(var c in t){var s=n&&n.type===c;t[c].isActive&&l.push(_.createElement("div",{className:"settings__item "},_.createElement(y,{key:"document-recipient-status}",isHorizontal:!0,name:t[c].title,values:[{id:0,value:"Начать новую продажу"},{id:1,value:"Это звонок после продажи"}],currentId:a?0:1,errorMessage:s&&n.error,selectCallback:function selectCallback(e){r(!e&&!0)}})))}return l};const N=function PostSaleQuestion(e){var t=e.questions,n=e.isActive,r=e.isCreateNewSale,c=(e.isSaleComplete,e.questionStatus,e.setIsNewSaleStatus),s=e.setSaleAnswer,o=e.cancel,i=(0,l.useState)(!1),p=(0,a.A)(i,2),m=p[0],d=p[1],f=(0,l.useState)(!1),g=(0,a.A)(f,2),b=(g[0],g[1],(0,l.useState)()),E=(0,a.A)(b,2);E[0],E[1];(0,l.useEffect)((function(){d(n)}),[n]);var y=function toggle(){s()};return _.createElement("div",null,_.createElement(S.A,(0,v.A)({isOpen:m,toggle:y},t),_.createElement(A.A,null,_.createElement(C,{questions:t,isCreateNewSale:r,setAnswer:c})),_.createElement(h.A,{className:"p-2 calling-modal-q-footer"},_.createElement(u.A,{size:"sm",color:"primary",onClick:y},"Запланировать"),_.createElement(u.A,{size:"sm",color:"danger",onClick:function close(){o(!1)}},"Отмена"))))};var I=n(4898),T=n(4530),w=n(6540);const P=(0,r.Ng)((function mapStateToProps(e,t){return{isActive:e.calling.sale.isActive,questions:e.calling.sale.questions,isSaleComplete:e.calling.sale.isSaleComplete,isCreateNewSale:e.calling.sale.isCreateNewSale,questionStatus:e.calling.sale.questionStatus}}),{setIsNewSaleStatus:I.N.setIsNewSaleStatus,cancel:I.N.setSaleQuestionStatus,setSaleAnswer:T.qj})((function PostSaleQuestionContainer(e){var t=e.questions,n=e.isActive,a=e.isCreateNewSale,r=e.setIsNewSaleStatus,l=e.isSaleComplete,c=e.questionStatus,s=e.setSaleAnswer,o=e.cancel;return w.createElement(N,{questions:t,isActive:n,isCreateNewSale:a,setIsNewSaleStatus:r,isSaleComplete:l,questionStatus:c,setSaleAnswer:s,cancel:o})}));const x=function Calling(e){e.domain,e.currentUser;var t=e.responsibility,n=e.createdBy,r=e.date,v=e.name,y=e.type,S=e.plan,A=(e.current,e.sale,e.isOneMore),h=e.isUnplannedPresentation,_=e.presentation,C=e.setCurentCallingProp,N=e.changeDeadline,I=e.createTask,T=e.fail,w=e.presentationDone,x=e.isFullComplete,O=(0,l.useState)(S),R=(0,a.A)(O,2),D=R[0],k=R[1],F=(0,l.useState)(t.current),j=(0,a.A)(F,2),M=j[0],U=j[1],L=(0,l.useState)(n.current),$=(0,a.A)(L,2),B=($[0],$[1],(0,l.useState)(!1)),Y=(0,a.A)(B,2),H=Y[0],q=Y[1];(0,l.useEffect)((function(){k(S)}),[S]),(0,l.useEffect)((function(){U(t.current)}),[t.current]);var z=function handleChange(e,t){C(e,t)};return l.createElement(l.Fragment,null,l.createElement("div",{className:"page-content calling-wrapper"},l.createElement(s.A,{fluid:!0},l.createElement(o.A,null,l.createElement("div",{className:"col-md-12 col-form-label calling-header"})),l.createElement(o.A,{className:"calling-background"},l.createElement(i.A,{sm:6},l.createElement("label",{htmlFor:"example-string-input",className:"col-md-12 col-form-label ".concat(H?"calling-name-label-error":"")},H?"Заполните обязательное поле - Тема звонка":"Название"),l.createElement("div",{className:"col-md-12 mt-2 mb-2"},l.createElement("input",{onChange:function onChange(e){return z(c.u$.NAME,e.target.value)},onFocus:function handleOnNameFocus(){H&&q(!1)},className:"form-control ".concat(H?"is-invalid":""),type:"text",id:"example-string-input",lang:"rus"})),l.createElement("label",{htmlFor:"description-string-input",className:"col-md-12 col-form-label"},"Комментарий"),l.createElement("div",{className:"col-md-12 mt-2  mb-2"},l.createElement("input",{onChange:function onChange(e){return z(c.u$.DESCRIPTION,e.target.value)},className:"form-control",type:"text",id:"description-string-input",lang:"rus"})),l.createElement("label",{htmlFor:"example-datetime-local-input",className:"col-md-12 col-form-label"},"Дата и время звонка"),l.createElement("div",{className:"col-md-12 mt-2   mb-2"},l.createElement("input",{className:"form-control",type:"datetime-local",defaultValue:r,id:"example-datetime-local-input",lang:"rus",onChange:function onChange(e){return N(e.target.value)}})),l.createElement("label",{className:"col-md-12 col-form-label"},"Тип звонка"),l.createElement("div",{className:"col-md-12 mt-2  mb-2"},l.createElement("select",{className:"form-control",value:y.current.id,onChange:function onChange(e){return z(c.u$.TYPE,e.target.value)}},y.items&&y.items.length&&y.items.map((function(e){return l.createElement("option",{key:"call-type-".concat(e.id),value:e.id},e.title)})))),l.createElement("label",{className:"col-md-12 col-form-label"},"Ответственный"),l.createElement("div",{className:"col-md-12 mt-2 mb-2"},l.createElement("select",{className:"form-control",value:M?M.ID:"",onChange:function onChange(e){z(c.u$.RESPONSIBILITY,e.target.value)}},t.items&&t.items.map((function(e){return l.createElement("option",{selected:M&&M.ID===e.ID,value:e.ID,key:"call-responsibility-".concat(e.ID)},e.NAME+" "+e.LAST_NAME)})))),l.createElement("div",{className:"col-md-12 mb-2 calling-btn-wrapper\r d-flex flex-row justify-content-end align-items-center",style:{width:"100%"}},l.createElement(u.A,{disabled:!x,onClick:function handleSubmit(){v?I():q(!0)},className:"btn col-md-8  calling-button call-button plan",size:"sm"},"Запланировать звонок"),l.createElement("div",{className:"col-md-4 d-flex flex-row justify-content-end "},l.createElement(u.A,{disabled:!x,onClick:function onClick(){return T()},className:"btn  col-md-10 calling-button call-button fail",style:{maxWidth:"90%"},size:"sm"},"Отказ"))),l.createElement(p.A,{check:!0,className:"col-md-12"},l.createElement(m.A,{check:!0,className:"col-md-8 mb-0 d-flex align-items-center"},l.createElement(d.A,{type:"checkbox",id:"flexCheckDefault",className:"mb-1 mr-3",style:{lineHeight:0},value:A,checked:A,key:"select-isOneMore",onChange:function onChange(e){z(c.u$.IS_ONE_MORE,e.target.checked)}}),l.createElement("p",{className:"mb-0 ml-3"},"Еще один")))),l.createElement(i.A,{sm:3},l.createElement("label",{className:"col-md-4 col-form-label"},"Презентации"),l.createElement("div",{className:"col-md-12 mt-2 mb-2 d-flex flex-row justify-content-between align-items-center"},l.createElement("p",{style:{width:"120px"},className:"col-md-3"},"Всего по компании"),l.createElement("div",{className:"f col-md-4"},l.createElement("input",{disabled:!0,className:"form-control",type:"text",id:"example-string-input",lang:"rus",value:_.companyCount}))),l.createElement("div",{className:"col-md-12 mb-2 d-flex flex-row justify-content-between align-items-center"},l.createElement("p",{style:{width:"120px"},className:"col-md-3"},"Всего по текущей продаже"),l.createElement("div",{className:"f col-md-4"},l.createElement("input",{disabled:!0,className:"form-control",type:"text",id:"example-string-input",lang:"rus",value:_.smartCout}))),l.createElement("label",{htmlFor:"example-string-input",className:"col-md-12 mt-1 col-form-label comment"},"Зафиксировать презентацию"),l.createElement(u.A,{disabled:!x,onClick:function onClick(){return w()},className:"btn col-md-12 mb-2 calling-button call-button presentation",size:"sm"},"Проведена Презентация"),l.createElement(p.A,{check:!0,className:"col-md-12"},l.createElement(m.A,{check:!0,className:"col-md-8 mb-0 d-flex align-items-center"},l.createElement(d.A,{type:"checkbox",id:"flexCheckDefault",className:"mb-1 mr-3",style:{lineHeight:0},value:h,checked:h,key:"select-isUnplannedPresentation",onChange:function onChange(e){z(c.u$.IS_UNPLANNED_PRESENTATION,e.target.checked)}}),l.createElement("p",{className:"mb-0 ml-3"},"Не была запланирована")))),l.createElement(i.A,{sm:3,className:"pt-200"},l.createElement("label",{className:"col-md-4 col-form-label"},"План на день"),l.createElement("div",{className:"col-md-10 plans"},D&&D.map((function(e,t){var n=null;if(e.deadline){var a=new Date(e.deadline);n=(0,b.GP)(a,"d MMMM yyyy г., HH:mm",{locale:E.A})}return l.createElement(f.A,{key:"task-card-".concat(t),className:"mb-10 calling-card",onClick:function onClick(){return redirectToTask(e)}},l.createElement(g.A,{className:"p-1"},l.createElement("div",null,n&&l.createElement("p",{className:"calling-task-card-date"},n+" "+e.responsible.name," "),l.createElement("p",{className:"calling-task-card-title"},e.title))))})))))),l.createElement(P,null)))};var O=n(3019),R=n(6540);(0,r.Ng)((function mapSTate(e){return{domain:e.app.domain,currentUser:e.app.currentUser,responsibility:e.calling.responsibility,createdBy:e.calling.createdBy,name:e.calling.name,type:e.calling.type,plan:e.calling.plan,date:e.calling.date,current:{responsibility:e.calling.responsibility.current,createdBy:e.calling.createdBy.current,type:e.calling.type.current,date:e.calling.type.date,time:e.calling.type.time,name:e.calling.type.name,description:e.calling.type.description},sale:e.calling.sale,presentation:e.calling.presentation,isFullComplete:e.calling.isFullComplete,isOneMore:e.calling.isOneMore,isUnplannedPresentation:e.calling.isUnplannedPresentation,isFinish:e.calling.isFinish,result:e.calling.result}}),{initialCalling:T.P5,setCurentCallingProp:T.zv,getCallingPlan:T.Wh,changeDeadline:T.B6,createTask:T.UT,fail:T.fJ,presentationDone:T.Rw,setFinishStatus:I.N.setFinishStatus})((function CallingContainer(e){var t=e.domain,n=e.responsibility,r=e.createdBy,c=e.name,s=e.type,o=e.date,i=e.plan,u=e.current,p=e.sale,m=e.presentation,d=e.setCurentCallingProp,f=e.initialCalling,g=(e.getCallingPlan,e.changeDeadline),b=e.createTask,E=e.fail,v=e.presentationDone,y=e.isFullComplete,S=e.isFinish,A=e.result,h=e.isOneMore,_=e.isUnplannedPresentation,C=e.setFinishStatus,N=(0,l.useState)(!1),I=(0,a.A)(N,2),T=I[0],w=I[1],P=(0,l.useState)(S),D=(0,a.A)(P,2),k=D[0],F=D[1];return(0,l.useEffect)((function(){T||k||(f(),w(!0))}),[T,k]),(0,l.useEffect)((function(){console.log("isFinish effect"),console.log(S),S&&w(!1),F(S)}),[S]),k?R.createElement(O.A,{result:A,setFinishStatus:C}):T&&R.createElement(x,{domain:t,responsibility:n,createdBy:r,date:o,name:c,type:s,plan:i,current:u,sale:p,presentation:m,isOneMore:h,isUnplannedPresentation:_,setCurentCallingProp:d,changeDeadline:g,createTask:b,fail:E,presentationDone:v,isFullComplete:y})}))},3019:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(6540),r=n(5169),l=n(5826),c=n(9704),s=n(7917);const o=function CallingFinish(e){var t=e.result,n=e.setFinishStatus;return a.createElement(a.Fragment,null,a.createElement("div",{className:"account-pages my-5 pt-2"},a.createElement(r.A,null,a.createElement(l.A,null,a.createElement(c.A,{lg:"12"},a.createElement("div",{className:"text-center mb-2"},a.createElement("h1",{className:"display-2 fw-medium"},a.createElement("i",{className:"bx bx-buoy bx-spin text-primary display-3"})),a.createElement("h4",{className:"text-uppercase"},t),a.createElement("div",{className:"mt-3 \r d-flex\r justify-content-center\r align-items-center\r "},a.createElement(s.A,{onClick:function startHendler(){n(!1,"")},className:"btn\r col-md-3\r calling-button\r d-flex justify-content-center\r bg-success\r pointer\r ",size:"sm"},"Запланировать еще"))))),a.createElement(l.A,{className:"justify-content-center"},a.createElement(c.A,{md:"8",xl:"6"})))))}},3268:(e,t,n)=>{n.d(t,{A:()=>L});var a=n(6540);const r="calling__page__wrapper--XFV5d",l="badge__warning--Zcpak",c="badge__star--bxc6R",s="badge__error--qXXGo",o="badge__errActive--m7juF",i="actionsCell--CDIrx",u="statusSuccess--v49Zi",p="statusWarning--A3gYa";var m=n(5826),d=n(9704),f=n(3342),g=n(6477),b=n(7075),E=n(9733),v=n(6556),y=n(4930),S=n(7535),A=n(8756),h=n(7917),_=n(6540);const C=function AprilModal(e){var t=e.children,n=(0,a.useState)(!1),r=(0,b.A)(n,2),l=(r[0],r[1],function toggle(){setSaleAnswer()}),c=function close(){cancel(!1)};return _.createElement("div",null,_.createElement(v.A,{isOpen:!1,toggle:l,size:"lg"},_.createElement(y.A,{className:"p-3",toggle:c},"Отчет о звонке и планирование"),_.createElement(S.A,null,_.createElement("div",null,t)),_.createElement(A.A,{className:"p-2 calling-modal-q-footer"},_.createElement(h.A,{size:"sm",color:"primary",onClick:l},"Отправить"),_.createElement(h.A,{size:"sm",color:"danger",onClick:c},"Отмена"))))};n(8575);var N=n(277),I=n(5169);const T=function ResultMenuPresentation(e){var t=e.presentation;e.presentationDone,e.isFullComplete;return a.createElement(a.Fragment,null,a.createElement("div",{className:"page-content"},a.createElement(I.A,{fluid:!0},a.createElement(m.A,{className:"mb-3"},a.createElement(d.A,{sm:3},a.createElement("h3",{className:"text__bold col-md-4 col-form-label"},"Презентации"))),a.createElement(m.A,null,a.createElement(d.A,{sm:12},a.createElement(m.A,null,a.createElement(d.A,{sm:3},a.createElement("p",{style:{width:"120px"},className:"text__small col-md-3"},"По компании")),a.createElement(d.A,{sm:3},a.createElement("div",{className:"f col-md-12"},a.createElement("input",{disabled:!0,className:"form-control",type:"text",id:"example-string-input",lang:"rus",value:t.companyCount}))),a.createElement(d.A,{sm:3},a.createElement("p",{style:{width:"120px"}},"Текущие")),a.createElement(d.A,{sm:3},a.createElement("div",{className:"f"},a.createElement("input",{disabled:!0,className:"form-control",type:"text",id:"example-string-input",lang:"rus",value:t.smartCout})))),a.createElement("div",{className:"d-flex flex-row flex-direction-row justify-content-start align-items-center"},a.createElement("label",{htmlFor:"example-string-input",className:"col-md-6 mt-1 col-form-label comment"},"Зафиксировать презентацию"),a.createElement(g.A,{style:{cursor:"pointer"},className:" col-md-3 font-size-11 badge-soft-danger badge bg-danger "},"Не было"),a.createElement(g.A,{style:{cursor:"pointer"},outline:!0,className:" col-md-3 font-size-11 badge-soft-danger ms-1 badge bg-success"},"Была проведена")))))))};const w=function ResultMenuSuccessReport(e){var t=e.currentResultStatus,n=e.currentFailReason,r=e.setCurentCallingProp,l=e.resultStatuses,c=e.failReasons,s=e.setCurrentFailReason,o=e.setCurrentResultStatus,i=(0,a.useState)(!1),u=(0,b.A)(i,2),p=(u[0],u[1],function handleChange(e,t){"result-status"===e?o(t):"fail-reasone"===e?s(t):r(e,t)});return a.createElement(a.Fragment,null,a.createElement("div",{className:"page-content"},a.createElement(I.A,{fluid:!0},a.createElement(m.A,null,a.createElement("div",{className:"col-md-12 col-form-label"})),a.createElement(m.A,{className:""},a.createElement(d.A,{sm:12},a.createElement("label",{className:"col-md-12 col-form-label"},"Результат Работы"),a.createElement("div",{className:"col-md-12 mt-2  mb-2"},a.createElement("select",{className:"form-control",onChange:function onChange(e){return p("result-status",e.target.value)}},l&&l.length&&l.map((function(e){return a.createElement("option",{key:"call-type-".concat(e.id),value:e.code},e.name)})))),"fail"===t&&a.createElement(a.Fragment,null,a.createElement("label",{className:"col-md-12 col-form-label"},"Причины отказа"),a.createElement("div",{className:"col-md-12 mt-2  mb-1"},a.createElement("select",{className:"form-control",value:n,onChange:function onChange(e){return p("fail-reasone",e.target.value)}},c&&c.length&&c.map((function(e){return a.createElement("option",{key:"call-type-".concat(e.id),value:e.code},e.name)}))))))))))};const P=function ResultMenuCallCreate(e){var t=e.responsibility,n=e.createdBy,r=e.date,l=(e.name,e.type),c=e.plan,s=e.setCurentCallingProp,o=e.changeDeadline,i=(e.createTask,(0,a.useState)(c)),u=(0,b.A)(i,2),p=(u[0],u[1]),m=(0,a.useState)(t.current),d=(0,b.A)(m,2),f=(d[0],d[1]),g=(0,a.useState)(n.current),E=(0,b.A)(g,2),v=(E[0],E[1],(0,a.useState)(!1)),y=(0,b.A)(v,2),S=y[0],A=y[1];(0,a.useEffect)((function(){p(c)}),[c]),(0,a.useEffect)((function(){f(t.current)}),[t.current]);var h=function handleChange(e,t){s(e,t)};return a.createElement(a.Fragment,null,a.createElement("label",{htmlFor:"example-string-input",className:"col-md-12 col-form-label ".concat(S?"calling-name-label-error":"")},S?"Заполните обязательное поле - Тема звонка":"Название - что нужно сделать"),a.createElement("div",{className:"col-md-12 mt-2 mb-2"},a.createElement("input",{onChange:function onChange(e){return h(N.u$.NAME,e.target.value)},onFocus:function handleOnNameFocus(){S&&A(!1)},className:"form-control ".concat(S?"is-invalid":""),type:"text",id:"example-string-input",lang:"rus"})),a.createElement("label",{htmlFor:"example-datetime-local-input",className:"col-md-12 col-form-label"},"Дата и время звонка"),a.createElement("div",{className:"col-md-12 mt-2   mb-2"},a.createElement("input",{className:"form-control",type:"datetime-local",defaultValue:r,id:"example-datetime-local-input",lang:"rus",onChange:function onChange(e){return o(e.target.value)}})),a.createElement("label",{className:"col-md-12 col-form-label"},"Тип звонка"),a.createElement("div",{className:"col-md-12 mt-2  mb-2"},a.createElement("select",{className:"form-control",value:l.current.id,onChange:function onChange(e){return h(N.u$.TYPE,e.target.value)}},l.items&&l.items.length&&l.items.map((function(e){return a.createElement("option",{key:"call-type-".concat(e.id),value:e.id},e.title)})))))};var x=n(6540);const O=function ResultComment(e){var t=e.handleChange,n=(0,a.useState)(!1),r=(0,b.A)(n,2),l=r[0],c=r[1];return x.createElement(x.Fragment,null,x.createElement("label",{htmlFor:"description-string-input",className:"col-md-12 col-form-label"},"Опишите кратко что было"),x.createElement("div",{className:"col-md-12 mt-2  mb-2"},x.createElement("textarea",{onChange:function onChange(e){return t(N.u$.DESCRIPTION,e.target.value)},onFocus:function handleOnNameFocus(){l&&c(!1)},className:"form-control",type:"text",id:"description-string-input",lang:"rus",rows:"8"})))};const R=function ResultMenuSuccess(e){var t=e.domain,n=e.currentUser,r=e.responsibility,l=e.createdBy,c=e.date,s=e.name,o=e.type,i=e.plan,u=e.current,p=e.sale,f=(e.isOneMore,e.isUnplannedPresentation),g=e.presentation,E=e.setCurentCallingProp,v=e.changeDeadline,y=e.createTask,S=e.fail,A=e.presentationDone,h=e.isFullComplete,_=(0,a.useState)(i),C=(0,b.A)(_,2),N=(C[0],C[1]),x=(0,a.useState)(r.current),R=(0,b.A)(x,2),D=(R[0],R[1]),k=(0,a.useState)(l.current),F=(0,b.A)(k,2),j=(F[0],F[1],(0,a.useState)(!1)),M=(0,b.A)(j,2),U=(M[0],M[1],(0,a.useState)("inJob")),L=(0,b.A)(U,2),$=L[0],B=L[1],Y=(0,a.useState)("other"),H=(0,b.A)(Y,2),q=H[0],z=H[1];(0,a.useEffect)((function(){N(i)}),[i]),(0,a.useEffect)((function(){D(r.current)}),[r.current]);return a.createElement(a.Fragment,null,a.createElement("div",{className:"page-content"},a.createElement(I.A,{fluid:!0},a.createElement(m.A,{className:"p-0"},a.createElement(d.A,{sm:6,className:"p-0"},a.createElement(w,{domain:t,currentUser:n,current:u,sale:p,currentFailReason:q,currentResultStatus:$,resultStatuses:[{id:0,code:"inJob",name:"В работе"},{id:1,code:"setAside",name:"Отложено"},{id:2,code:"success",name:"Продажа"},{id:3,code:"fail",name:"Отказ"}],failReasons:[{id:0,code:"secretar",name:"Секретарь"},{id:1,code:"concurent",name:"Остались на конкуренте"},{id:2,code:"phoneFail",name:"Не берут трубку"},{id:3,code:"other",name:"Ссылаются на третьих лиц"},{id:4,code:"money",name:"Дорого/нет Денег"}],setCurrentResultStatus:B,setCurrentFailReason:z,setCurentCallingProp:E,createTask:y,fail:S,isFullComplete:h})),a.createElement(d.A,{sm:6,className:"p-0"},a.createElement(T,{isUnplannedPresentation:f,presentation:g,presentationDone:A,isFullComplete:h}))),a.createElement(m.A,{className:"mt-5"},a.createElement(d.A,{sm:6},a.createElement("h3",{className:"text__bold"}," История Работы")),a.createElement(d.A,{sm:6},a.createElement("h3",{className:"text__bold"}," Информация о клиенте"))),a.createElement(m.A,{className:"mt-5"},a.createElement(d.A,{sm:6},a.createElement("h3",{className:"text__bold"}," Комментарий")),a.createElement(d.A,{sm:6},a.createElement("h3",{className:"text__bold"}," Планирование следующего звонка"))),a.createElement(m.A,null,a.createElement(d.A,{sm:6},a.createElement(O,{handleChange:function handleChange(e,t){E(e,t)}})),("inJob"===$||"setAside"===$)&&a.createElement(d.A,{sm:6},a.createElement(P,{responsibility:r,createdBy:l,date:c,name:s,type:o,plan:i,changeDeadline:v,setCurentCallingProp:E}))))))};var D=n(6540);const k=function ResultMenu(e){e.isSuccess;var t=e.domain,n=e.currentUser,a=e.responsibility,r=e.createdBy,l=e.date,c=e.name,s=e.type,o=e.plan,i=e.current,u=e.sale,p=e.isOneMore,m=e.isUnplannedPresentation,d=e.presentation,f=e.setCurentCallingProp,g=e.changeDeadline,b=e.createTask,E=e.fail,v=e.presentationDone,y=e.isFullComplete;return D.createElement(C,null,D.createElement(R,{domain:t,currentUser:n,responsibility:a,createdBy:r,date:l,name:c,type:s,plan:o,current:i,sale:u,isOneMore:p,isUnplannedPresentation:m,presentation:d,setCurentCallingProp:f,changeDeadline:g,createTask:b,fail:E,presentationDone:v,isFullComplete:y}))};var F=n(4530),j=n(4898),M=n(6540);const U=(0,E.Ng)((function mapSTate(e){return{domain:e.app.domain,currentUser:e.app.currentUser,responsibility:e.calling.responsibility,createdBy:e.calling.createdBy,name:e.calling.name,type:e.calling.type,plan:e.calling.plan,date:e.calling.date,current:{responsibility:e.calling.responsibility.current,createdBy:e.calling.createdBy.current,type:e.calling.type.current,date:e.calling.type.date,time:e.calling.type.time,name:e.calling.type.name,description:e.calling.type.description},sale:e.calling.sale,presentation:e.calling.presentation,isFullComplete:e.calling.isFullComplete,isOneMore:e.calling.isOneMore,isUnplannedPresentation:e.calling.isUnplannedPresentation,isFinish:e.calling.isFinish,result:e.calling.result}}),{initialCalling:F.P5,setCurentCallingProp:F.zv,getCallingPlan:F.Wh,changeDeadline:F.B6,createTask:F.UT,fail:F.fJ,presentationDone:F.Rw,setFinishStatus:j.N.setFinishStatus})((function ResultMenuContainer(e){var t=e.domain,n=e.responsibility,r=e.createdBy,l=e.name,c=e.type,s=e.date,o=e.plan,i=e.current,u=e.sale,p=e.presentation,m=e.setCurentCallingProp,d=e.initialCalling,f=(e.getCallingPlan,e.changeDeadline),g=e.createTask,E=e.fail,v=e.presentationDone,y=e.isFullComplete,S=e.isFinish,A=(e.result,e.isOneMore),h=e.isUnplannedPresentation,_=(e.setFinishStatus,(0,a.useState)(!1)),C=(0,b.A)(_,2),N=C[0],I=C[1],T=(0,a.useState)(S),w=(0,b.A)(T,2),P=w[0],x=w[1];return(0,a.useEffect)((function(){N||P||(d(),I(!0))}),[N,P]),(0,a.useEffect)((function(){console.log("isFinish effect"),console.log(S),S&&I(!1),x(S)}),[S]),M.createElement(k,{success:!0,domain:t,currentUser:n,responsibility:n,createdBy:r,date:s,name:l,type:c,plan:o,current:i,sale:u,isOneMore:A,isUnplannedPresentation:h,presentation:p,setCurentCallingProp:m,changeDeadline:f,createTask:g,fail:E,presentationDone:v,isFullComplete:y})}));const L=function CallingReportTable(e){var t=e.tasks;return a.createElement(a.Fragment,null,a.createElement(U,null),a.createElement(m.A,null,a.createElement(d.A,{xl:12},a.createElement("div",{className:"table-responsive p-4 ".concat(r)},a.createElement("div",{className:"table-responsive"},a.createElement(f.A,{className:"align-middle mb-0"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"#"),a.createElement("th",null,"Что надо сделать"),a.createElement("th",null,"Тип"),a.createElement("th",null,"Крайний срок"),a.createElement("th",null,"Текущий статус"),a.createElement("th",null,"Действие"))),a.createElement("tbody",null,t&&t.length&&t.map((function(e,t){return a.createElement("tr",null,a.createElement("th",{scope:"row"},t+1),a.createElement("td",null,e.name),a.createElement("td",null,e.type),a.createElement("td",null,e.deadline),a.createElement("td",null,"no"===e.isExpired?a.createElement("span",{className:"".concat(u)},"Запланирован"):"yes"===e.isExpired?a.createElement("span",{className:"".concat(p)},"Просрочен"):a.createElement(g.A,{className:l},"Скоро")),a.createElement("td",{className:i},a.createElement("button",{type:"button",className:"btn btn-sm  mr-5 ".concat(c)},"Результативный"),a.createElement("button",{type:"button",className:"btn btn-sm ms-2 ".concat(s)},"Не очень"),a.createElement("button",{type:"button",className:"btn btn-sm ms-2 ".concat(o)},"Перенос")))})))))))))}},3862:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(7075),r=n(9733),l=n(6540),c=n(4898),s=n(5750),o=n(3268),i=n(3019),u=n(6540);const p=(0,r.Ng)((function mapSTate(e){return{domain:e.app.domain,currentUser:e.app.currentUser,responsibility:e.calling.responsibility,tasks:e.report.tasks,isFinish:e.calling.isFinish,result:e.calling.result}}),{initialCallingReport:s.lX,setFinishStatus:c.N.setFinishStatus})((function CallingReportContainer(e){var t=e.domain,n=e.responsibility,r=e.isFinish,c=e.result,s=e.setFinishStatus,p=e.tasks,m=e.initialCallingReport,d=(0,l.useState)(!1),f=(0,a.A)(d,2),g=f[0],b=f[1],E=(0,l.useState)(r),v=(0,a.A)(E,2),y=v[0],S=v[1];return(0,l.useEffect)((function(){g||y||(m(),b(!0))}),[g,y]),(0,l.useEffect)((function(){console.log("isFinish effect"),console.log(r),r&&b(!1),S(r)}),[r]),y?u.createElement(i.A,{result:c,setFinishStatus:s}):g&&u.createElement(o.A,{domain:t,responsibility:n,tasks:p})}))},6750:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(6540),r=n(6229);const l=function Logo(){return a.createElement("img",{className:"logo",src:r,alt:"logo"})};n(4003),n(9245);var c=n(6540);const s=function Gradient(e){e.isResized;var t=e.isActive,n=(e.currentRoute,(0,a.useRef)(null));return(0,a.useEffect)((function(){}),[]),c.createElement("div",{ref:n,className:"monohrom__containerApril"},c.createElement("div",{className:"content__wrapper"},c.createElement("div",{className:"newchildren__wrapper"},c.createElement(l,null)),t&&c.createElement("p",{className:"loader__title"},"Загрузка  . . .")))};const o=(0,n(9733).Ng)((function mapStateToProps(e,t){return{isResized:e.app.isResized,isActive:t.isActive}}),{})(s);var i=n(6540);const u=function Preloader(e){var t=e.currentRoute;return i.createElement(o,{currentRoute:t,isActive:!0},i.createElement(l,null))}},3733:(e,t,n)=>{n.d(t,{Ay:()=>x,Fc:()=>w,Vh:()=>T});var a=n(4705),r=n(467),l=n(4756),c=n.n(l),s=n(4003),o=n(9002),i=n(8205),u=n(8329),p=n(9245),m=n(1715),d=n(6266).A.create({baseURL:"https://script.google.com/macros/s",headers:{"content-type":"application/json"}});d.defaults.redirect="follow";var f=function get(e){return(0,r.A)(c().mark((function _callee(){var t;return c().wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.get("/".concat(e,"/exec?action=data"));case 3:if(!(t=n.sent).data){n.next=6;break}return n.abrupt("return",t.data);case 6:n.next=10;break;case 8:n.prev=8,n.t0=n.catch(0);case 10:case"end":return n.stop()}}),_callee,null,[[0,8]])})))()},g=function incrementParticipants(e){return(0,r.A)(c().mark((function _callee2(){var t;return c().wrap((function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.get("/".concat(e,"/exec?action=incrementParticipants"));case 3:if(!(t=n.sent).data){n.next=6;break}return n.abrupt("return",t.data);case 6:n.next=10;break;case 8:n.prev=8,n.t0=n.catch(0);case 10:case"end":return n.stop()}}),_callee2,null,[[0,8]])})))()},b="AKfycby3bH62ant92_XJUwZw2iccfDobaEPq_2Wf0K0pi7bAqEiHtIXySYjW3_o2p77ifh1O2A";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E="SET_APP_DEAL",v="SET_RESIZE_STATUS",y="SET_APP_DATA",S="SET_APP_BITRIX_DATA",A="SET_INITIALIZED_SUCCESS",h={domain:"",company:null,user:"",currentUser:null,token:"",dealId:null,bitrix:{company:null,deal:null,lead:null},isResized:!1,initialized:!1},_=function setAppData(e,t,n,a,r,l){return{type:y,domain:e,companyId:t,userId:n,currentUser:a,token:r,dealId:l}},C=function setAppBitrixData(e,t){return{type:S,company:e,deal:t}},N=function setResizeStatus(e){return{type:v,boolean:e}},I=function setInitializedSuccess(){return{type:A}},T=function initial(){return function(){var e=(0,r.A)(c().mark((function _callee(e,t){var n,a,r,l,o;return c().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,f(b);case 2:return c.sent,c.next=5,g(b);case 5:if(c.sent,e((0,u.Z)(!0)),n=t(),a=n.router.current,i.db&&a.route===p.a$.CALLING&&e(P()),!i.db){c.next=16;break}return c.next=13,s.l.getDomain();case 13:c.t0=c.sent,c.next=17;break;case 16:c.t0=null;case 17:if(r=c.t0,l=r||i.Ss,!a||!a.route){c.next=36;break}if(a.route!==p.a$.CALLING){c.next=33;break}if(console.log("ROUTE.CALLING"),console.log(p.a$.CALLING),c.t1=i.db,!c.t1){c.next=28;break}return c.next=27,s.l.getCurrentUser();case 27:c.t1=c.sent;case 28:o=c.t1,e(_(l,null,null,o,"",null)),e(I()),c.next=36;break;case 33:e(_(l,null,null,null,"",null)),e(I()),e((0,u.Z)(!1));case 36:e((0,p._t)(p.xY.CALLING,!1)),e((0,u.Z)(!1));case 38:case"end":return c.stop()}}),_callee)})));return function(t,n){return e.apply(this,arguments)}}()},w=function getBitrixData(e,t,n,a,l,u){return function(){var d=(0,r.A)(c().mark((function _callee2(r,d){var f,g,b,E,v,y,S,A;return c().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(null,null,f={currentCompany:null,currentDeal:null},g=null,b=null,E=!1,console.log("app get bitrix data getBitrixData"),!i.db){c.next=15;break}return c.next=10,s.l.getDealAndCompany(l,a);case 10:f=c.sent,console.log("getDealAndCompany result"),console.log(f),c.next=25;break;case 15:if(!a){c.next=20;break}return v={domain:e,companyId:a},c.next=19,o.o_.service("bitrixcompany",m.b.POST,"company",v);case 19:f.currentCompany=c.sent;case 20:if(!l){c.next=25;break}return y={domain:e,dealId:l},c.next=24,o.o_.service("bitrixdeal",m.b.POST,"deal",y);case 24:f.currentCompany=c.sent;case 25:console.log("app get bitrix data result"),console.log(a),console.log(l),S=f.company,A=f.deal,S&&S.ID&&(g=S.ID),A&&A.ID&&(b=A.ID),r(_(e,g,n,t,u,b)),r(C(S,A)),r((0,p._t)(p.xY.KONSTRUCTOR,E));case 35:case"end":return c.stop()}}),_callee2)})));return function(e,t){return d.apply(this,arguments)}}()},P=function getResizeCalling(){return function(){var e=(0,r.A)(c().mark((function _callee5(e,t){return c().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.l.getResizeCalling();case 2:e(N(!0));case 3:case"end":return t.stop()}}),_callee5)})));return function(t,n){return e.apply(this,arguments)}}()};const x=function app(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return console.log("SET_APP_DATA"),console.log(t),_objectSpread(_objectSpread({},e),{},{domain:t.domain,company:t.companyId,user:t.userId,token:t.token,dealId:t.dealId,currentUser:t.currentUser});case S:return console.log("SET_APP_BITRIX_DATA"),console.log(t.company),console.log(t.deal),_objectSpread(_objectSpread({},e),{},{bitrix:_objectSpread(_objectSpread({},e.bitrix),{},{company:t.company,deal:t.deal}),initialized:!0});case E:return _objectSpread(_objectSpread({},e),{},{dealId:t.dealId,bitrix:_objectSpread(_objectSpread({},e.bitrix),{},{deal:t.deal})});case v:return console.log("SET_RESIZE_STATUS"),console.log(t.status),_objectSpread(_objectSpread({},e),{},{isResized:t.status});case A:return _objectSpread(_objectSpread({},e),{},{initialized:!0});default:return e}}},8329:(e,t,n)=>{n.d(t,{A:()=>s,Z:()=>c});var a=n(4705);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var r={inProgress:!0},l="PRELOADER",c=function setPreloader(e){return{type:l,bool:e}};const s=function preloader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1?arguments[1]:void 0;return t.type===l&&e.inProgress!==t.bool?_objectSpread(_objectSpread({},e),{},{inProgress:t.bool}):e}},9002:(e,t,n)=>{n.d(t,{o_:()=>h});var a=n(467),r=n(4705),l=n(4756),c=n.n(l),s=n(8205),o=n(1715),i=n(6266);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=i.A.create({baseURL:s.R4?"http://localhost:8000/api":"https://april-online.ru/api",withCredentials:!0,headers:(0,r.A)((0,r.A)((0,r.A)({"content-type":"application/json",accept:"application/json"},"accept","application/json"),"X-Requested-With","XMLHttpRequest"),"X-API-KEY","e0336d3b27299e405a344d2475627c5810eab829a4e5c1214e452e20519d5984")});i.A.create({baseURL:s.R4?"http://localhost:8000":"https://april-online.ru",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}});b=(0,a.A)(c().mark((function _callee3(){var e,t,n;return c().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return e=null,a.prev=1,a.next=4,u.get("profile");case 4:return t=a.sent,(n=t.data)&&(0===n.resultCode?e=n.deal:n.message),a.abrupt("return",e);case 10:return a.prev=10,a.t0=a.catch(1),a.abrupt("return",e);case 13:case"end":return a.stop()}}),_callee3,null,[[1,10]])}))),g=(0,a.A)(c().mark((function _callee4(e){var t,n;return c().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,a.prev=1,a.next=4,u.post("deal",_objectSpread({},e));case 4:return(n=a.sent)&&(0===n.resultCode?t=n.deal:n.message),a.abrupt("return",t);case 9:return a.prev=9,a.t0=a.catch(1),a.abrupt("return",t);case 12:case"end":return a.stop()}}),_callee4,null,[[1,9]])}))),f=(0,a.A)(c().mark((function _callee5(e,t){var n,a,r;return c().wrap((function _callee5$(l){for(;;)switch(l.prev=l.next){case 0:return n=null,l.prev=1,l.next=4,u.post("getDeal",{dealId:e,domain:t});case 4:return a=l.sent,(r=a.data)&&0===r.resultCode&&(n=r.deal),l.abrupt("return",n);case 10:return l.prev=10,l.t0=l.catch(1),l.abrupt("return",n);case 13:case"end":return l.stop()}}),_callee5,null,[[1,10]])}))),d=(0,a.A)(c().mark((function _callee6(e,t,n,a,r){var l,s,o,i;return c().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return l=null,c.prev=1,c.next=4,u.post("getDescription",{domain:e,userId:t,complect:n,infoblocks:a,groups:r});case 4:if(!(s=c.sent)||!s.data||0!==s.data.resultCode){c.next=9;break}return o=s.data.file,i=s.data.fileBase64,c.abrupt("return",{link:o,file:i});case 9:c.next=14;break;case 11:return c.prev=11,c.t0=c.catch(1),c.abrupt("return",l);case 14:case"end":return c.stop()}}),_callee6,null,[[1,11]])}))),m=(0,a.A)(c().mark((function _callee7(e,t,n,a,r){var l,s;return c().wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return l=null,c.prev=1,c.next=4,u.post("get/offer",{domain:e,userId:t,complect:n,infoblocks:a,groups:r});case 4:(s=c.sent)&&s.data&&s.data.resultCode,c.next=11;break;case 8:return c.prev=8,c.t0=c.catch(1),c.abrupt("return",l);case 11:case"end":return c.stop()}}),_callee7,null,[[1,8]])}))),p=(0,a.A)(c().mark((function _callee8(e,t,n){var a,r;return c().wrap((function _callee8$(n){for(;;)switch(n.prev=n.next){case 0:return a=null,n.prev=1,n.next=4,u.post("get/offer",{domain:e,userId:t,complect,infoblocks,groups});case 4:(r=n.sent)&&r.data&&r.data.resultCode,n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(1),n.abrupt("return",a);case 11:case"end":return n.stop()}}),_callee8,null,[[1,8]])})));var p,m,d,f,g,b,E,v,y,S,A,h={getCollection:(y=(0,a.A)(c().mark((function _callee9(e,t,n,a){var r,l;return c().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if(r=null,c.prev=1,a){c.next=8;break}return c.next=5,u[t](e);case 5:c.t0=c.sent,c.next=11;break;case 8:return c.next=10,u[t](e,a);case 10:c.t0=c.sent;case 11:if(!(l=c.t0)){c.next=15;break}return l.data&&0===l.data.resultCode&&l.data[n]&&(r=l.data.isCollection?l.data[n].data:l.data[n]),c.abrupt("return",r);case 15:c.next=20;break;case 17:return c.prev=17,c.t1=c.catch(1),c.abrupt("return",r);case 20:case"end":return c.stop()}}),_callee9,null,[[1,17]])}))),function getCollection(e,t,n,a){return y.apply(this,arguments)}),setCollection:(v=(0,a.A)(c().mark((function _callee10(e,t){var n,a,l;return c().wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return n=null,c.prev=1,a=(0,r.A)({},e,t),c.next=5,u.post(e,a);case 5:return(l=c.sent)&&0===l.data.resultCode&&(n=l.data.data),c.abrupt("return",n);case 10:return c.prev=10,c.t0=c.catch(1),c.abrupt("return",n);case 13:case"end":return c.stop()}}),_callee10,null,[[1,10]])}))),function setCollection(e,t){return v.apply(this,arguments)}),service:(E=(0,a.A)(c().mark((function _callee11(e,t,n,a){var r,l;return c().wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return r=null,c.prev=1,c.next=4,u[t](e,a);case 4:return(l=c.sent)&&l.data&&(0===l.data.resultCode?r=l.data.data?l.data.data[n]:l.data[n]:1===l.data.resultCode&&(l.data.message?console.log("".concat(n," ").concat(l.data.message)):console.log(l))),c.abrupt("return",r);case 9:return c.prev=9,c.t0=c.catch(1),c.abrupt("return",r);case 12:case"end":return c.stop()}}),_callee11,null,[[1,9]])}))),function service(e,t,n,a){return E.apply(this,arguments)})},_=(S=(0,a.A)(c().mark((function _callee12(e,t,n,a,l,s,i,p,m,d,f,g,b,E,v,y,S,A){var h,_,C,N,I,T,w,P,x,O,R,D;return c().wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return C=null,N={FIELDS:(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)({},E.dealName.bitrixId,"".concat(t)),E.assigned.bitrixId,n),E.category.bitrixId,E.category.value),E.stage.bitrixId,E.stage.value),E.opened.bitrixId,E.opened.value),"PROBABILITY",30),"OPPORTUNITY",0),"CURRENCY_ID","RUB"),"UF_CRM_5B39D7C2EC0AB",!0),PARAMS:{REGISTER_SONET_EVENT:"Y"}},I=isNaN(+y.contractSupplyPropSuppliesQuantity)?1:+y.contractSupplyPropSuppliesQuantity,T=S?S.contractConsaltingProp:y.contractConsaltingProp,w=S?S.contractConsaltingComment:y.contractConsaltingComment,P={id:a,fields:(h={},(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)(h,b.contract.bitrixId,l),b.companyId.bitrixId,s),b.npa.bitrixId,i.npa),b.la.bitrixId,i.la),b.c.bitrixId,i.c),b.sp.bitrixId,i.sp),b.er.bitrixId,p.er),b.per.bitrixId,p.per),b.erinpac.bitrixId,p.erinpac),b.lt.bitrixId,d.lt),(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)(h,b.plt.bitrixId,d.plt),b.ltinpac.bitrixId,d.ltinpac),b.freeBlocks.bitrixId,m),b.consalting.bitrixId,f),b.field_14.bitrixId,g),E.category.bitrixId,E.category.value),E.stage.bitrixId,"C".concat(E.category.value,":NEW"))),PARAMS:{REGISTER_SONET_EVENT:"Y"}},x={id:a,fields:(_={},(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)(_,v.complectName.bitrixId,y.name),v.abonementTime.bitrixId,1===y.contractCoefficient?null:y.contractCoefficient),v.consalting.bitrixId,T),v.note2.bitrixId,w),v.hdd.bitrixId,y.contractSupplyProp1?y.contractSupplyProp1:""),v.way.bitrixId,y.contractSupplyProp2?y.contractSupplyProp2:""),v.note.bitrixId,y.contractSupplyPropComment?y.contractSupplyPropComment:""),v.note3.bitrixId,y.contractSupplyPropEmail?y.contractSupplyPropEmail:""),v.supply.bitrixId,y.supplyName?y.supplyName:""),v.supplyForContract.bitrixId,y.contractSupplyName?y.contractSupplyName:""),(0,r.A)((0,r.A)((0,r.A)((0,r.A)(_,v.loginsQuantity.bitrixId,y.contractSupplyPropLoginsQuantity?y.contractSupplyPropLoginsQuantity:""),v.contractSupplyPropSuppliesQuantity.bitrixId,I),v.supplyForContract.bitrixId,y.contractSupplyName),v.field_1.bitrixId,y.quantityForKp))},O=A.map((function(e,t){var n=e.prepayment,r=e.price.current,l=e.price.default,c=l-r;return{id:e.id||e.number,priceNetto:l,price:r,discountSum:c,discountTypeId:1,ownerId:a,ownerType:"D",productName:"".concat(e.name," ").concat(e.supply.name),quantity:e.price.quantity||n,customized:"Y",supply:e.supplyName,measureCode:e.price.measure.code,measureId:e.price.measure.id,sort:t}})),R={domain:e,dealId:a,setDealData:N,updateDealInfoblocksData:P,updateDealContractData:x,setProductRowsData:{ownerType:"D",ownerId:a,productRows:O},updateProductRowsData:{id:null,fields:{priceNetto:null,price:null,discountSum:null,discountTypeId:1}}},c.prev=11,c.next=14,u[o.b.POST]("konstructor/bitrix/deal/update",R);case 14:return(D=c.sent)&&D.data&&(0===D.data.resultCode?D.data.data&&(C=D.data.data.dealId):1===D.data.resultCode&&(D.data.message?console.log("".concat(D.data.message)):console.log(D))),c.abrupt("return",C);case 19:return c.prev=19,c.t0=c.catch(11),c.abrupt("return",C);case 22:case"end":return c.stop()}}),_callee12,null,[[11,19]])}))),i.A.create({baseURL:"http://localhost:8000/api",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}}));A=(0,a.A)(c().mark((function _callee13(e,t,n,a){var r,l;return c().wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return r=null,c.prev=1,c.next=4,_[t](e,a);case 4:return(l=c.sent)&&l.data&&(0===l.data.resultCode?r=l.data.data?l.data.data[n]:l.data[n]:1===l.data.resultCode&&(l.data.message?console.log("".concat(n," ").concat(l.data.message)):console.log(l))),c.abrupt("return",r);case 9:return c.prev=9,c.t0=c.catch(1),c.abrupt("return",r);case 12:case"end":return c.stop()}}),_callee13,null,[[1,9]])})))},4003:(e,t,n)=>{n.d(t,{l:()=>h});var a=n(467),r=n(4705),l=n(4756),c=n.n(l),s=n(3953);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var o,i,u,p,m,d,f,g,b,E,v,y,S,A,h={getPlacement:(A=(0,a.A)(c().mark((function _callee(){var e;return c().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.ot.info();case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),_callee)}))),function getPlacement(){return A.apply(this,arguments)}),getCompanyId:(S=(0,a.A)(c().mark((function _callee2(){var e,t;return c().wrap((function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,h.getPlacement();case 3:return e=n.sent,t=e.options.ID,n.abrupt("return",Number(t));case 8:return n.prev=8,n.t0=n.catch(0),n.abrupt("return",null);case 11:case"end":return n.stop()}}),_callee2,null,[[0,8]])}))),function getCompanyId(){return S.apply(this,arguments)}),getCurrentUserId:(y=(0,a.A)(c().mark((function _callee3(e){var t,n;return c().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,a.next=3,(0,s.g9)("crm.company.get",{id:e});case 3:return n=(n=a.sent).answer&&n.answer.result,t=n?n.ASSIGNED_BY_ID:null,a.abrupt("return",t);case 7:case"end":return a.stop()}}),_callee3)}))),function getCurrentUserId(e){return y.apply(this,arguments)}),getCurrentUser:(v=(0,a.A)(c().mark((function _callee4(){var e,t;return c().wrap((function _callee4$(n){for(;;)switch(n.prev=n.next){case 0:return e=null,n.prev=1,n.next=4,(0,s.g9)("user.current");case 4:return(t=n.sent)&&t.answer&&t.answer.result&&t.answer.result.ID&&(e=t.answer.result),n.abrupt("return",e);case 9:return n.prev=9,n.t0=n.catch(1),console.log(n.t0),n.abrupt("return",null);case 13:case"end":return n.stop()}}),_callee4,null,[[1,9]])}))),function getCurrentUser(){return v.apply(this,arguments)}),getResize:(E=(0,a.A)(c().mark((function _callee5(){var e,t;return c().wrap((function _callee5$(n){for(;;)switch(n.prev=n.next){case 0:return e=.9*window.screen.height,t=.73*window.screen.width,n.next=5,(0,s.Ru)(t,e);case 5:n.sent;case 6:case"end":return n.stop()}}),_callee5)}))),function getResize(){return E.apply(this,arguments)}),getResizeCalling:(b=(0,a.A)(c().mark((function _callee6(){return c().wrap((function _callee6$(e){for(;;)switch(e.prev=e.next){case 0:return window.screen.height,window.screen.width,e.next=5,(0,s.eQ)();case 5:e.sent;case 6:case"end":return e.stop()}}),_callee6)}))),function getResizeCalling(){return b.apply(this,arguments)}),getScroll:(g=(0,a.A)(c().mark((function _callee7(){var e,t;return c().wrap((function _callee7$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,console.log("scroll"),n.next=4,(0,s.TC)();case 4:return e=n.sent,console.log(e),n.next=8,(0,s.OO)(100);case 8:t=n.sent,console.log(t),n.next=14;break;case 12:n.prev=12,n.t0=n.catch(0);case 14:case"end":return n.stop()}}),_callee7,null,[[0,12]])}))),function getScroll(){return g.apply(this,arguments)}),getLead:(f=(0,a.A)(c().mark((function _callee8(e){var t,n;return c().wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,console.log("crm.lead.get"),a.prev=2,a.next=5,s.g9("crm.lead.get",{id:e});case 5:return(n=a.sent)&&n.answer&&n.answer.result&&(t=n.answer.result,console.log(t)),a.abrupt("return",t);case 10:return a.prev=10,a.t0=a.catch(2),console.log("error"),console.log(dealResponse),console.log(a.t0),a.abrupt("return",t);case 16:case"end":return a.stop()}}),_callee8,null,[[2,10]])}))),function getLead(e){return f.apply(this,arguments)}),getCompany:(d=(0,a.A)(c().mark((function _callee9(e){var t,n;return c().wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,console.log("crm.company.get"),a.prev=2,a.next=5,s.g9("crm.company.get",{id:e,select:["TITLE","ID","UF_CRM_1706007840","UF_CRM_1706007882","UF_CRM_1706007856"]});case 5:return(n=a.sent)&&n.answer&&n.answer.result&&(t=n.answer.result,console.log(t)),a.abrupt("return",t);case 10:return a.prev=10,a.t0=a.catch(2),console.log("error"),console.log(dealResponse),console.log(a.t0),a.abrupt("return",t);case 16:case"end":return a.stop()}}),_callee9,null,[[2,10]])}))),function getCompany(e){return d.apply(this,arguments)}),getDeal:(m=(0,a.A)(c().mark((function _callee10(e){var t,n;return c().wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,a.prev=1,a.next=4,s.g9("crm.deal.get",{id:e,select:["TITLE","COMPANY_ID","ID","UF_CRM_1695372881","UF_CRM_1695373462","UF_CRM_1695373326"]});case 4:return(n=a.sent)&&n.answer&&n.answer.result&&(t=n.answer.result),a.abrupt("return",t);case 9:return a.prev=9,a.t0=a.catch(1),console.log("error"),console.log(dealResponse),console.log(a.t0),a.abrupt("return",t);case 15:case"end":return a.stop()}}),_callee10,null,[[1,9]])}))),function getDeal(e){return m.apply(this,arguments)}),getDealAndCompany:(p=(0,a.A)(c().mark((function _callee11(){var e,t,n,a,r=arguments;return c().wrap((function _callee11$(l){for(;;)switch(l.prev=l.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:null,t=r.length>1&&void 0!==r[1]?r[1]:null,l.prev=2,n=null,a=null,t||!e){l.next=16;break}return l.next=8,h.getDeal(e);case 8:if(!(n=l.sent)||!n.COMPANY_ID){l.next=14;break}return t=n.COMPANY_ID,l.next=13,h.getCompany(t);case 13:a=l.sent;case 14:l.next=21;break;case 16:if(!t||e){l.next=21;break}return l.next=19,h.getCompany(t);case 19:a=l.sent,n&&n.COMPANY_ID&&(t=n.COMPANY_ID);case 21:return console.log("dealResult"),console.log(n),console.log("currentCompanyId"),console.log(t),console.log("Результаты batch запроса:"),console.log("Компания:",a),console.log("Сделка:",n),l.abrupt("return",{company:a,deal:n});case 31:return l.prev=31,l.t0=l.catch(2),console.error("Произошла ошибка при выполнении запроса",l.t0),l.abrupt("return",{company:null,deal:null});case 35:case"end":return l.stop()}}),_callee11,null,[[2,31]])}))),function getDealAndCompany(){return p.apply(this,arguments)}),getSmart:(u=(0,a.A)(c().mark((function _callee12(e){var t,n;return c().wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return t=null,$method="/crm.item.list.json",$data={entityTypeId:e,filter:{"=assignedById":$userId,COMPANY_ID:$companyId}},a.prev=3,a.next=6,s.g9("crm.item.list",{id:dealId});case 6:return(n=a.sent)&&n.answer&&n.answer.result&&(t=n.answer.result.items),a.abrupt("return",t);case 11:return a.prev=11,a.t0=a.catch(3),console.log("error"),console.log(dealResponse),console.log(a.t0),a.abrupt("return",t);case 17:case"end":return a.stop()}}),_callee12,null,[[3,11]])}))),function getSmart(e){return u.apply(this,arguments)}),getDomain:(i=(0,a.A)(c().mark((function _callee13(){var e;return c().wrap((function _callee13$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.xI();case 2:return t.sent,t.next=5,s.FB();case 5:return e=t.sent,t.abrupt("return",e);case 7:case"end":return t.stop()}}),_callee13)}))),function getDomain(){return i.apply(this,arguments)}),updateRecipient:(o=(0,a.A)(c().mark((function _callee14(e,t,n,a,r){var l,o,i,u,p,m,d,f,g;return c().wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:if(!e&&!t){c.next=28;break}if(!(n||a||r)){c.next=28;break}return l={},o={},n&&(l.UF_CRM_1706007840=n,o.UF_CRM_1695372881=n),a&&(l.UF_CRM_1706007856=a,o.UF_CRM_1695373326=a),r&&(l.UF_CRM_1706007882=r,o.UF_CRM_1695373462=r),i={ID:e,FIELDS:_objectSpread({},o),PARAMS:{REGISTER_SONET_EVENT:"Y"}},u={ID:t,FIELDS:_objectSpread({},l),PARAMS:{REGISTER_SONET_EVENT:"Y"}},p="crm.company.update",m=null,d=null,c.prev=13,c.next=16,s.g9("crm.deal.update",_objectSpread({},i));case 16:return f=c.sent,c.next=19,s.g9(p,_objectSpread({},u));case 19:return g=c.sent,m=f.answer&&f.answer.result,d=g.answer&&g.answer.result,c.abrupt("return",{deal:m,company:d});case 25:return c.prev=25,c.t0=c.catch(13),c.abrupt("return",m);case 28:case"end":return c.stop()}}),_callee14,null,[[13,25]])}))),function updateRecipient(e,t,n,a,r){return o.apply(this,arguments)})}},5750:(e,t,n)=>{n.d(t,{Ay:()=>y,lX:()=>g});var a,r,l,c=n(9002),s=n(4929),o=n(291),i=n(8205),u=n(4003),p=n(1715),m=n(5580),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)},__awaiter=function(e,t,n,a){return new(n||(n=Promise))((function(r,l){function fulfilled(e){try{step(a.next(e))}catch(e){l(e)}}function rejected(e){try{step(a.throw(e))}catch(e){l(e)}}function step(e){e.done?r(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((a=a.apply(e,t||[])).next())}))},__generator=function(e,t){var n,a,r,l,c={label:0,sent:function sent(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,a&&(r=2&s[0]?a.return:s[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,s[1])).done)return r;switch(a=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,a=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){c.label=s[1];break}if(6===s[0]&&c.label<r[1]){c.label=r[1],r=s;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(s);break}r[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],a=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};!function(e){e.COLD="cold",e.WARM="warm",e.PRESENTATION="presentation",e.HOT="hot"}(a||(a={})),r||(r={}),function(e){e.LEAD="LEAD",e.COMPANY="COMPANY"}(l||(l={}));var d={tasks:null,isFetched:!1},f=function setFetchedTasks(e){return{type:"report/SET_FITCHED_TASKS",tasks:e}},g=function initialCallingReport(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,s,o,m,d,g,y;return __generator(this,(function(S){switch(S.label){case 0:return n=t(),a=n.app.domain,r=n.app.currentUser,(s=i.db)?[4,u.l.getPlacement()]:[3,2];case 1:s=S.sent(),S.label=2;case 2:return l=s,o={domain:a||i.Ss,userId:r||i.wV,placement:l||{placement:"COMPANY",options:{ID:i.pY}}},[4,c.o_.service("bitrix/callingreport",p.b.POST,"tasks",o)];case 3:return m=S.sent(),d={domain:a||i.Ss,userId:r||i.wV},[4,c.o_.service("front/portal",p.b.POST,"portal",d)];case 4:return S.sent(),m&&m.length&&(g=m.map((function(e){var t=E(e.title),n=t.type;return{name:t.name,type:n,isExpired:b(e),deadline:v(e.deadline)}})),e(f(g))),y=t(),console.log("initializedState"),console.log(y),[2]}}))}))}},b=function checkIfTaskIsOverdue(e){var t="no",n=new Date,a=new Date(e.deadline);a<n?t="yes":(a.setHours(0,0,0,0),n.setHours(0,0,0,0),n.getTime()===a.getTime()&&(t="almost"));return t},E=function parseTaskTitle(e){e.match(/^(.*?)(?=\sзапланирован)/),e.match(/запланирован[ао]?\s+(.*?)\s+\d{2}\.\d{2}\.\d{4}/);return{type:"Запланирован",name:e.replace(/\d{2}\.\d{2}\.\d{4} \d{2}:\d{2}:\d{2}/,"").trim()}},v=function getFormatDate(e){if(e){var t=(0,s.H)(e);return(0,o.GP)(t,"d MMMM yyyy HH:mm",{locale:m.ru})}return""};const y=function report(e,t){return void 0===e&&(e=d),"report/SET_FITCHED_TASKS"===t.type?__assign(__assign({},e),{tasks:t.tasks}):e}},4898:(e,t,n)=>{n.d(t,{N:()=>a});var a={setFetchedCallings:function setFetchedCallings(e){return{type:"callings/SET_FITCHED_CALLINGS",callings:e}},setFetchedDepartament:function setFetchedDepartament(e,t,n,a){return{type:"callings/SET_FITCHED_DEPARTAMENT",departament:e,currentUser:t,placement:n,domain:a}},setPrimrtiveStateProp:function setPrimrtiveStateProp(e,t){return{type:"callings/SET_STATE_PROP",name:e,value:t}},setSaleComplete:function setSaleComplete(){return{type:"callings/SET_SALE_COMPLETE"}},setIsNewSaleStatus:function setIsNewSaleStatus(e){return{type:"callings/SET_IS_NEW_SALE_STATUS",status:e}},setSaleQuestionStatus:function setSaleQuestionStatus(e){return{type:"callings/SET_SALE_QUESTION_STATUS",status:e}},setSaleAnswerStatus:function setSaleAnswerStatus(e){return{type:"callings/SET_SALE_ANSWER_STATUS",status:e}},setPresentationCount:function setPresentationCount(e,t){return{type:"callings/SET_PRESENTATION_COUNT",count:e,entityType:t}},setFullCompleteStatus:function setFullCompleteStatus(e){return{type:"callings/SET_FULL_COMPLETE_STATUS",status:e}},setFinishStatus:function setFinishStatus(e,t){return{type:"callings/SET_FINISH_STATUS",status:e,result:t}}}},277:(e,t,n)=>{n.d(t,{Ay:()=>u,YI:()=>r,u$:()=>l,u7:()=>c});var a,r,l,c,s=n(291),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)};!function(e){e.COLD="cold",e.WARM="warm",e.PRESENTATION="presentation",e.HOT="hot"}(r||(r={})),function(e){e.NAME="name",e.DESCRIPTION="description",e.RESPONSIBILITY="responsibility",e.CREATED_BY="createdBy",e.DATE="date",e.TIME="time",e.TYPE="type",e.STATUS="status",e.CRM="crm",e.PLAN="plan",e.COMPANY="company",e.LEAD="lead",e.SMART="smart",e.SALE="sale",e.PRESENTATION="presentation",e.IS_ONE_MORE="isOneMore",e.IS_UNPLANNED_PRESENTATION="isUnplannedPresentation"}(l||(l={})),function(e){e.LEAD="LEAD",e.COMPANY="COMPANY"}(c||(c={}));var o=function getInitialDate(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);return{first:(0,s.GP)(t,"yyyy-MM-dd"),current:(0,s.GP)(e,"yyyy-MM-dd HH:mm:ss")}},i=((a={})[l.RESPONSIBILITY]={items:[],current:null},a[l.CREATED_BY]={items:[],current:null},a.type={items:[{id:1,name:r.WARM,title:"Звонок"},{id:2,name:r.PRESENTATION,title:"Презентация"}],current:{id:1,name:r.WARM,title:"Звонок"}},a.name="",a[l.DESCRIPTION]="",a.date=o().current,a.time=null,a.plan=[],a.placement=null,a.groupId=28,a.company=null,a.smart=null,a[l.SALE]={isActive:!1,questionStatus:!1,isSaleComplete:!1,isCreateNewSale:!1,questions:{new:{id:0,title:"Уже сделана продажа этому клиенту",isActive:!0,value:!0,isAnswered:!1}}},a.presentation={companyCount:0,smartCout:0},a[l.IS_ONE_MORE]=!1,a[l.IS_UNPLANNED_PRESENTATION]=!1,a.isFullComplete=!1,a.isFinish=!1,a.result="",a);const u=function calling(e,t){var n,a,c;switch(void 0===e&&(e=i),t.type){case"callings/SET_FITCHED_CALLINGS":return __assign(__assign({},e),{calling:t.callings});case"callings/SET_FITCHED_DEPARTAMENT":var s=t.currentUser?t.currentUser:t.departament[0],u=107;return"alfacentr.bitrix24.ru"===t.domain&&(u=158),__assign(__assign({},e),{responsibility:__assign(__assign({},e.responsibility),{items:t.departament,current:s}),createdBy:__assign(__assign({},e.createdBy),{items:t.departament,current:{ID:u}}),placement:t.placement});case"callings/SET_STATE_PROP":switch(t.name){case l.RESPONSIBILITY:case l.CREATED_BY:case l.TYPE:return __assign(__assign({},e),((n={})[t.name]=__assign(__assign({},e[t.name]),{current:t.value}),n));default:return __assign(__assign({},e),((a={})[t.name]=t.value,a))}case"callings/SET_SALE_COMPLETE":return __assign(__assign({},e),{sale:__assign(__assign({},e.sale),{isSaleComplete:!0})});case"callings/SET_IS_NEW_SALE_STATUS":return __assign(__assign({},e),{sale:__assign(__assign({},e.sale),{isCreateNewSale:t.status})});case"callings/SET_SALE_ANSWER_STATUS":return __assign(__assign({},e),{sale:__assign(__assign({},e.sale),{questionStatus:t.status})});case"callings/SET_SALE_QUESTION_STATUS":return __assign(__assign({},e),{sale:__assign(__assign({},e.sale),{isActive:t.status})});case"callings/SET_PRESENTATION_COUNT":var p=__assign({},e.presentation);return"company"==t.entityType?p.companyCount=t.count:"smart"==t.entityType&&(p.smartCout=t.count),__assign(__assign({},e),{presentation:__assign(__assign({},e.presentation),p)});case"callings/SET_FULL_COMPLETE_STATUS":return __assign(__assign({},e),{isFullComplete:t.status});case"callings/SET_FINISH_STATUS":return console.log("callings/SET_FINISH_STATUS"),console.log({isFinish:t.status,result:t.result}),(c={})[l.RESPONSIBILITY]={items:[],current:null},c[l.CREATED_BY]={items:[],current:null},c.type={items:[{id:1,name:r.WARM,title:"Звонок"},{id:2,name:r.PRESENTATION,title:"Презентация"}],current:{id:1,name:r.WARM,title:"Звонок"}},c.name="",c[l.DESCRIPTION]="",c.date=o().current,c.time=null,c.plan=[],c.placement=null,c.groupId=28,c.company=null,c.smart=null,c[l.SALE]={isActive:!1,questionStatus:!1,isSaleComplete:!1,isCreateNewSale:!1,questions:{new:{id:0,title:"Уже сделана продажа этому клиенту",isActive:!0,value:!0,isAnswered:!1}}},c.presentation={companyCount:0,smartCout:0},c[l.IS_ONE_MORE]=!1,c[l.IS_UNPLANNED_PRESENTATION]=!1,c.isFullComplete=!1,c.isFinish=t.status,c.result=t.result,c;default:return e}}},4530:(e,t,n)=>{n.d(t,{B6:()=>N,UT:()=>P,fJ:()=>fail,Wh:()=>I,P5:()=>C,Rw:()=>presentationDone,zv:()=>w,qj:()=>x});var a,r,l,c,s,o,i=n(9002),u=n(291),p=n(8205),m=n(4003),d=n(8329),f=n(4705),g=n(467),b=n(4756),E=n.n(b),v=n(6266).A.create({baseURL:"https://april-hook.ru/api",withCredentials:!0,headers:{"content-type":"application/json",accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),y={getCollection:(l=(0,g.A)(E().mark((function _callee(e,t,n){var a,r,l,c=arguments;return E().wrap((function _callee$(s){for(;;)switch(s.prev=s.next){case 0:if(a=c.length>3&&void 0!==c[3]?c[3]:null,r=null,s.prev=2,a){s.next=9;break}return s.next=6,v[t](e);case 6:s.t0=s.sent,s.next=12;break;case 9:return s.next=11,v[t](e,a);case 11:s.t0=s.sent;case 12:if(!(l=s.t0)){s.next=16;break}return l.data&&0===l.data.resultCode&&l.data[n]&&(r=l.data.isCollection?l.data[n].data:l.data[n]),s.abrupt("return",r);case 16:s.next=21;break;case 18:return s.prev=18,s.t1=s.catch(2),s.abrupt("return",r);case 21:case"end":return s.stop()}}),_callee,null,[[2,18]])}))),function getCollection(e,t,n){return l.apply(this,arguments)}),setCollection:(r=(0,g.A)(E().mark((function _callee2(e,t){var n,a,r;return E().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return n=null,l.prev=1,a=(0,f.A)({},e,t),l.next=5,v.post(e,a);case 5:return(r=l.sent)&&0===r.data.resultCode&&(n=r.data.data),l.abrupt("return",n);case 10:return l.prev=10,l.t0=l.catch(1),l.abrupt("return",n);case 13:case"end":return l.stop()}}),_callee2,null,[[1,10]])}))),function setCollection(e,t){return r.apply(this,arguments)}),service:(a=(0,g.A)(E().mark((function _callee3(e,t,n,a){var r,l;return E().wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return r=null,c.prev=1,console.log("hook api"),c.next=5,v[t](e,a);case 5:return l=c.sent,console.log(l),l&&l.data&&0===l.data.resultCode&&(r=l.data[n]),c.abrupt("return",r);case 11:return c.prev=11,c.t0=c.catch(1),c.abrupt("return",r);case 14:case"end":return c.stop()}}),_callee3,null,[[1,11]])}))),function service(e,t,n,r){return a.apply(this,arguments)})},S={create:(o=(0,g.A)(E().mark((function _callee4(e,t,n,a,r,l,c,s,o,i,u,p,m,d){var f,g,b;return E().wrap((function _callee4$(E){for(;;)switch(E.prev=E.next){case 0:return f=null,g={type:e,auth:{domain:t},company_id:n,deadline:a,responsible:r,created:l,name:c,comment:s,crm:o,company:i,smart:u,sale:p,isOneMore:m,placement:d},E.prev=2,E.next=5,v.post("task/warm",g);case 5:return(b=E.sent)&&b.data&&0===b.data.resultCode&&(f=b.data),E.abrupt("return",f);case 10:return E.prev=10,E.t0=E.catch(2),E.abrupt("return",f);case 13:case"end":return E.stop()}}),_callee4,null,[[2,10]])}))),function create(e,t,n,a,r,l,c,s,i,u,p,m,d,f){return o.apply(this,arguments)}),fail:(s=(0,g.A)(E().mark((function _callee5(e,t,n,a,r){var l,c,s;return E().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return l=null,c={auth:{domain:e},company_id:t,placement:n,smart:r,responsible:a},console.log("fail"),console.log(c),o.prev=4,o.next=7,v.post("task/fail",c);case 7:return(s=o.sent)&&s.data&&0===s.data.resultCode&&(l=s.data.result),o.abrupt("return",l);case 12:return o.prev=12,o.t0=o.catch(4),o.abrupt("return",l);case 15:case"end":return o.stop()}}),_callee5,null,[[4,12]])}))),function fail(e,t,n,a,r){return s.apply(this,arguments)}),presentationDone:(c=(0,g.A)(E().mark((function _callee6(e,t,n,a,r,l,c){var s,o,i;return E().wrap((function _callee6$(u){for(;;)switch(u.prev=u.next){case 0:return s=null,o={auth:{domain:e},company_id:t,placement:n,company:r,smart:l,responsibleId:a,isUnplannedPresentation:c},console.log("presentation/done"),console.log(o),u.prev=4,u.next=7,v.post("presentation/done",o);case 7:return(i=u.sent)&&i.data&&0===i.data.resultCode&&(s=i.data.result),u.abrupt("return",s);case 12:return u.prev=12,u.t0=u.catch(4),u.abrupt("return",s);case 15:case"end":return u.stop()}}),_callee6,null,[[4,12]])}))),function presentationDone(e,t,n,a,r,l,s){return c.apply(this,arguments)})},A=n(1715),h=n(4898),_=n(277),__awaiter=function(e,t,n,a){return new(n||(n=Promise))((function(r,l){function fulfilled(e){try{step(a.next(e))}catch(e){l(e)}}function rejected(e){try{step(a.throw(e))}catch(e){l(e)}}function step(e){e.done?r(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((a=a.apply(e,t||[])).next())}))},__generator=function(e,t){var n,a,r,l,c={label:0,sent:function sent(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function verb(s){return function(o){return function step(s){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(c=0)),c;)try{if(n=1,a&&(r=2&s[0]?a.return:s[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,s[1])).done)return r;switch(a=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,a=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){c.label=s[1];break}if(6===s[0]&&c.label<r[1]){c.label=r[1],r=s;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(s);break}r[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],a=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},C=function initialCalling(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,c,s,o,u,d;return __generator(this,(function(f){switch(f.label){case 0:return(a=p.db)?[4,m.l.getPlacement()]:[3,2];case 1:a=f.sent(),f.label=2;case 2:return n=a,e(h.N.setFinishStatus(!1,"")),r=null,n&&n.placement&&(r=n,console.log("calling placement"),console.log(r)),l=t(),c=l.app.domain,s=l.app.currentUser,o=null,console.log(s),u={domain:c},[4,i.o_.service("bitrix/departament","post","departament",u)];case 3:return(o=f.sent())&&e(h.N.setFetchedDepartament(o,s,r,c)),e(I()),n&&n.options?e(T(n)):e(h.N.setFullCompleteStatus(!0)),d=t(),console.log("initializedState"),console.log(d),[2]}}))}))}},N=function changeDeadline(e){return function(t,n){return __awaiter(void 0,void 0,void 0,(function(){var a,r,l,c,s,o,u;return __generator(this,(function(p){switch(p.label){case 0:return a=n(),r=a.app.domain,l=a.calling[_.u$.RESPONSIBILITY].current,c=e.split("T"),s=c[0],o={domain:r,userId:l&&l.ID,date:s},[4,i.o_.service("bitrix/callingtasks","post","tasks",o)];case 1:return(u=p.sent())&&t(h.N.setPrimrtiveStateProp(_.u$.PLAN,u)),t(h.N.setPrimrtiveStateProp(_.u$.DATE,e)),[2]}}))}))}},I=function getCallingPlan(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,c,s;return __generator(this,(function(o){switch(o.label){case 0:return n=t(),a=n.app.domain,r=n.calling[_.u$.RESPONSIBILITY].current,l=n.calling.date,c={domain:a,userId:r&&r.ID,date:l},[4,i.o_.service("bitrix/callingtasks","post","tasks",c)];case 1:return(s=o.sent())&&e(h.N.setPrimrtiveStateProp(_.u$.PLAN,s)),[2]}}))}))}},T=function getBitrixItems(e){return function(t,n){return __awaiter(void 0,void 0,void 0,(function(){var a,r,l,c,s,o,i,u,d,f,g,b,E;return __generator(this,(function(v){switch(v.label){case 0:return Number(e.options.ID),null,e.placement.includes(_.u7.LEAD)?_.u7.LEAD:e.placement.includes(_.u7.COMPANY)&&_.u7.COMPANY,a=n(),r=null,l=a.app.domain,c=a.calling[_.u$.RESPONSIBILITY].current,e.placement.includes(_.u7.LEAD)?(s=Number(e.options.ID),(i=p.db)?[4,m.l.getLead(s)]:[3,2]):[3,5];case 1:i=v.sent(),v.label=2;case 2:return(o=i)?(b={domain:l,leadId:s,userId:null==c?void 0:c.ID},[4,y.service("smart/item/fromlead",A.b.POST,"data",b)]):[3,4];case 3:r=v.sent(),console.log(r),r&&(r.ufCrm10_1709111529&&t(h.N.setPresentationCount(r.ufCrm10_1709111529,"smart")),r.ufCrm6_1709894507&&t(h.N.setPresentationCount(r.ufCrm6_1709894507,"smart")),t(h.N.setPrimrtiveStateProp(_.u$.SMART,r)),r.stageId&&("DT162_26:SUCCESS"!==r.stageId&&"DT156_12:SUCCESS"!==r.stageId||t(h.N.setSaleComplete()))),o&&(t(h.N.setPrimrtiveStateProp(_.u$.LEAD,o)),u=n().calling[_.u$.LEAD],t(h.N.setFullCompleteStatus(u))),v.label=4;case 4:return[3,10];case 5:return e.placement.includes(_.u7.COMPANY)?(d=Number(e.options.ID),(g=p.db)?[4,m.l.getCompany(d)]:[3,7]):[3,10];case 6:g=v.sent(),v.label=7;case 7:return(f=g)?(b={domain:l,companyId:d,userId:null==c?void 0:c.ID},[4,y.service("smart/item",A.b.POST,"data",b)]):[3,10];case 8:return r=v.sent(),console.log(r),r&&(r.ufCrm10_1709111529&&t(h.N.setPresentationCount(r.ufCrm10_1709111529,"smart")),r.ufCrm6_1709894507&&t(h.N.setPresentationCount(r.ufCrm6_1709894507,"smart")),t(h.N.setPrimrtiveStateProp(_.u$.SMART,r)),r.stageId&&("DT162_26:SUCCESS"!==r.stageId&&"DT156_12:SUCCESS"!==r.stageId||t(h.N.setSaleComplete()))),f?(f.UF_CRM_1709807026&&t(h.N.setPresentationCount(f.UF_CRM_1709807026,"company")),[4,t(h.N.setPrimrtiveStateProp(_.u$.COMPANY,f))]):[3,10];case 9:v.sent(),E=n().calling[_.u$.COMPANY],t(h.N.setFullCompleteStatus(E)),v.label=10;case 10:return[2]}}))}))}},w=function setCurentCallingProp(e,t){return function(n,a){return __awaiter(void 0,void 0,void 0,(function(){var r,l,c,s,o,u,p,m,d;return __generator(this,(function(f){switch(f.label){case 0:switch(r=a(),l=r.app.domain,e){case _.u$.RESPONSIBILITY:case _.u$.CREATED_BY:return[3,1];case _.u$.TYPE:return[3,3];case _.u$.NAME:case _.u$.DESCRIPTION:case _.u$.IS_ONE_MORE:case _.u$.IS_UNPLANNED_PRESENTATION:return[3,4]}return[3,5];case 1:return c=r.calling[e].items,s=c.find((function(e){return e.ID==t})),n(h.N.setPrimrtiveStateProp(e,s)),o=r.calling[_.u$.DATE],u={domain:l,userId:s.ID,date:o},[4,i.o_.service("bitrix/callingtasks","post","tasks",u)];case 2:return(p=f.sent())&&n(h.N.setPrimrtiveStateProp(_.u$.PLAN,p)),[3,6];case 3:return m=r.calling[e].items,d=m.find((function(e){return e.id==t})),n(h.N.setPrimrtiveStateProp(e,d)),[3,6];case 4:return n(h.N.setPrimrtiveStateProp(e,t)),[3,6];case 5:return[3,6];case 6:return[2]}}))}))}},P=function createTask(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,c,s,o,i,p,m,f,g,b,E,v,y,A,C,N;return __generator(this,(function(I){switch(I.label){case 0:return n=t(),a=n.app.domain,n.app.company,r=n.calling,l=r[_.u$.RESPONSIBILITY].current,c=r[_.u$.CREATED_BY].current,s=r[_.u$.TYPE].current,o=r[_.u$.NAME],i=r[_.u$.DESCRIPTION],p=r[_.u$.DATE],s&&o&&l&&c&&p?[3,1]:(alert("Не заполнено обязательное поле"),[3,5]);case 1:return m=n.calling[_.u$.SALE],f=m.questionStatus,!m.isSaleComplete||f?[3,2]:(e(h.N.setSaleQuestionStatus(!0)),[3,4]);case 2:return e((0,d.Z)(!0)),e(h.N.setSaleQuestionStatus(!1)),g=(0,u.GP)(new Date(p),"dd.MM.yyyy HH:mm:ss"),b=r.placement,E=null,v=r[_.u$.COMPANY],y=r[_.u$.SMART],A=r[_.u$.IS_ONE_MORE],b&&b.options&&(E=b.options.ID),[4,S.create(s.name,a,E,g,"user_".concat(l.ID),"user_".concat(c.ID),o,i,null,v,y,m,A,b)];case 3:C=I.sent(),console.log("created task"),console.log(C),N="Звонок запланирован",s.name===_.YI.PRESENTATION&&(N="Презентация запланирована"),e(h.N.setFinishStatus(!0,N)),I.label=4;case 4:e((0,d.Z)(!1)),I.label=5;case 5:return[2]}}))}))}},fail=function fail(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,c,s,o,i;return __generator(this,(function(u){switch(u.label){case 0:return e((0,d.Z)(!0)),n=t(),a=n.app.domain,r=n.calling,l=r[_.u$.SMART],c=r[_.u$.RESPONSIBILITY].current,s=r.placement,o=null,s&&s.options&&(o=s.options.ID),[4,S.fail(a,o,s,"user_".concat(c.ID),l)];case 1:return i=u.sent(),console.log("fail task"),console.log(i),e((0,d.Z)(!1)),[2]}}))}))}},presentationDone=function presentationDone(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,l,c,s,o,i,u,p;return __generator(this,(function(m){switch(m.label){case 0:return e((0,d.Z)(!0)),n=t(),a=n.app.domain,r=n.calling,l=r.placement,c=null,s=n.calling[_.u$.COMPANY],o=n.calling[_.u$.SMART],i=n.calling[_.u$.IS_UNPLANNED_PRESENTATION],u=r[_.u$.RESPONSIBILITY].current,l&&l.options&&(c=l.options.ID),[4,S.presentationDone(a,c,l,"user_".concat(u.ID),s,o,i)];case 1:return p=m.sent(),console.log("created task"),console.log(p),e((0,d.Z)(!1)),[2]}}))}))}},x=function setSaleAnswer(){return function(e,t){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){return e(h.N.setSaleAnswerStatus(!0)),e(P()),[2]}))}))}}},9245:(e,t,n)=>{n.d(t,{QB:()=>u,_t:()=>o,a$:()=>a,xY:()=>r});var a,r,l=n(8329),__assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)};!function(e){e.GLOBAL="global",e.KONSTRUCTOR="konstructor",e.PRODUCTS="products",e.TEMPLATE="template",e.DOCUMENT="document",e.REPORT="report",e.CALLING="calling",e.TRANSKRIBATION="transcribation",e.FINISH="finish"}(a||(a={})),function(e){e.KONSTRUCTOR="konstructor",e.REPORT="report",e.CALLING="calling",e.TRANSKRIBATION="transcribation"}(r||(r={}));var c={routes:[{id:0,name:"Начальные настройки",route:a.GLOBAL},{id:1,name:"Конструктор",route:a.KONSTRUCTOR},{id:2,name:"Цены и сравнение комплектов",route:a.PRODUCTS},{id:3,name:"Выбор Шаблона",route:a.TEMPLATE},{id:4,name:"Документ",route:a.DOCUMENT},{id:5,name:"Отчет",route:a.REPORT},{id:6,name:"Звонки",route:a.CALLING},{id:7,name:"Транскрибация",route:a.TRANSKRIBATION},{id:8,name:"Финиш",route:a.FINISH}],current:{id:6,name:"Звонки",route:a.CALLING},previous:null,next:null},s=function setCurrentRoute(e){return{type:"router/SET_CURRENT",id:e}},o=function setInitialRoute(e,t){return function(e,t){e(i(a.CALLING))}},i=function navigate(e){return function(t,n){console.log("navigate "+e);var a=n().router.routes.find((function(t){return t.route===e}));if(a){var r=a.id;t(s(r))}t((0,l.Z)(!1))}},u=function router(e,t){if(void 0===e&&(e=c),"router/SET_CURRENT"===t.type){var n=e.routes.find((function(e){return e.id==t.id})),a=e.current,r=e.previous;return n?__assign(__assign({},e),{current:n,previous:a,next:r}):e}return e}},1715:(e,t,n)=>{var a,r;n.d(t,{b:()=>a}),function(e){e.GET="get",e.POST="post",e.PUT="put",e.DELETE="delete"}(a||(a={})),function(e){e.ENTITY="entity",e.ENTITIES="entities"}(r||(r={}))}}]);